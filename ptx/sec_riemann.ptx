<?xml version="1.0" encoding="UTF-8"?>
<section xml:id="sec_riemann">
  <title>Riemann Sums</title>
  <introduction>
    <figure xml:id="vid_int_rie_intro" component="video">
      <caption>Video introduction to <xref ref="sec_riemann"/></caption>
      <video youtube="-4hZaGBw6EI"/>
    </figure>

    <p>
      In the previous section we defined the definite integral of a function on <m>[a,b]</m> to be the signed area between the curve and the <m>x</m>-axis.
      Some areas were simple to compute;
      we ended the section with a region whose area was not simple to compute.
      In this section we develop a technique to find such areas.
          <idx><h>Riemann Sum</h></idx>
    </p>

    <p>
      A fundamental calculus technique is to first answer a given problem with an approximation,
      then refine that approximation to make it better,
      then use limits in the refining process to find the exact answer.
      That is what we will do here.
    </p>

    <p>
      Consider the region given in <xref ref="fig_rie1a">Figure</xref>,
      which is the area under <m>y=4x-x^2</m> on <m>[0,4]</m>.
      What is the signed area of this region <mdash/> <ie/>, what is <m>\int_0^4(4x-x^2)\, dx</m>?
    </p>

    <figure xml:id="fig_rie1a">
      <caption>A graph of <m>f(x) = 4x-x^2</m>. What is the area of the shaded region?</caption>
      <!-- START figures/fig_rie1a.tex -->
      <image xml:id="img_rie1a" width="47%">
        <description></description>
        <latex-image>

        \begin{tikzpicture}

        \begin{axis}[
        axis on top,
        xtick={1,2,3,4},
        ytick={1,2,3,4},
        ymin=-1,ymax=5,
        xmin=-.5,xmax=4.5
        ]

        \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2};
        \addplot [firstcurvestyle,-,domain=-0.2:4.2,samples=45] {4*x-x^2};

        \end{axis}
        \end{tikzpicture}

        </latex-image>
      </image>
      <!-- figures/fig_rie1a.tex END -->
    </figure>

    <p>
      We start by approximating.
      We can surround the region with a rectangle with height and width of 4 and find the area is approximately 16 square units.
      This is obviously an <em>over-approximation</em>;
      we are including area in the rectangle that is not under the parabola.
    </p>

    <figure xml:id="fig_rie1a2">
      <caption>Approximating area under a curve with one rectangle</caption>
      <image xml:id="img_rie1a2" width="47%">
        <description></description>
        <latex-image>

        \begin{tikzpicture}

        \begin{axis}[
        axis on top,
        xtick={1,2,3,4},
        ytick={1,2,3,4},
        ymin=-1.2,ymax=5,
        xmin=-.5,xmax=4.5
        ]

        \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2} \closedcycle;
        \addplot [firstcurvestyle,-,domain=-.2:4.2,samples=40] {4*x-x^2} node [pos=1, left] { $y=4x-x^2$};

        \draw [thick,secondcolor] (axis cs:0,0) rectangle (axis cs:4,4);

        \end{axis}
        \end{tikzpicture}

        </latex-image>
      </image>

    </figure>

    <p>
      We have an approximation of the area, using one rectangle.
      How can we refine our approximation to make it better?
      The key to this section is this answer:
      <em>use more rectangles.</em>
    </p>

    <p>
      Let's use four rectangles with an equal width of 1.
      This <em>partitions</em> the interval <m>[0,4]</m> into 4 <em>subintervals</em>,
      <m>[0,1]</m>, <m>[1,2]</m>, <m>[2,3]</m> and <m>[3,4]</m>.
      On each subinterval we will draw a rectangle.
    </p>

    <p>
      There are three common ways to determine the height of these rectangles:
      the <em>Left Hand Rule</em>,
      the <em>Right Hand Rule</em>,
      and the <em>Midpoint Rule</em>.
      The <em>Left Hand Rule</em> says to evaluate the function at the left-hand endpoint of the subinterval and make the rectangle that height.
      In <xref ref="fig_rie1b">Figure</xref>,
      the rectangle drawn on the interval <m>[2,3]</m> has height determined by the Left Hand Rule;
      it has a height of <m>f(2)</m>. (The rectangle is labeled <q>LHR.</q>)
          <idx><h>Left Hand Rule</h></idx>
          <idx><h>Right Hand Rule</h></idx>
          <idx><h>Midpoint Rule</h></idx>
    </p>

    <figure xml:id="fig_rie1b">
      <caption>Approximating <m>\int_0^4(4x-x^2)\, dx</m> using rectangles. The heights of the rectangles are determined using different rules.</caption>
      <!-- START figures/fig_rie1b.tex -->
      <image xml:id="img_rie1b" width="47%">
        <description></description>
        <latex-image>

        \begin{tikzpicture}

        \begin{axis}[
        axis on top,
        xtick={1,2,3,4},
        ytick={1,2,3,4},
        ymin=-1,ymax=5,
        xmin=-.5,xmax=4.5
        ]

        \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2};
        \addplot [firstcurvestyle,-,domain=0:4,samples=40] {4*x-x^2};

        \draw [thick,secondcolor] (axis cs:0,0) rectangle (axis cs:1,3);
        \draw [thick,secondcolor] (axis cs:1,0) rectangle (axis cs:2,3.75);
        \draw [thick,secondcolor] (axis cs:2,0) rectangle (axis cs:3,4);
        \draw [thick,secondcolor] (axis cs:3,0) rectangle (axis cs:4,1.666);

        \draw [fill=black] (axis cs:1,3) circle (1pt);
        \draw [fill=black] (axis cs:1.5,3.75) circle (1pt);
        \draw [fill=black] (axis cs:2,4) circle (1pt);
        \draw [fill=black] (axis cs:3.53,1.666) circle (1pt);

        \draw (axis cs:.5,.3) node { RHR};
        \draw (axis cs:1.5,.3) node { MPR};
        \draw (axis cs:2.5,.3) node { LHR};
        \draw (axis cs:3.5,.3) node { other};
        \end{axis}

        \end{tikzpicture}

        </latex-image>
      </image>
      <!-- figures/fig_rie1b.tex END -->
    </figure>

    <p>
      The <em>Right Hand Rule</em> says the opposite:
      on each subinterval,
      evaluate the function at the right endpoint and make the rectangle that height.
      In the figure,
      the rectangle drawn on <m>[0,1]</m> is drawn using <m>f(1)</m> as its height;
      this rectangle is labeled <q>RHR.</q>.
    </p>

    <p>
      The <em>Midpoint Rule</em> says that on each subinterval,
      evaluate the function at the midpoint and make the rectangle that height.
      The rectangle drawn on <m>[1,2]</m> was made using the Midpoint Rule,
      with a height of <m>f(1.5)</m>.
      That rectangle is labeled <q>MPR.</q>
    </p>

    <p>
      These are the three most common rules for determining the heights of approximating rectangles,
      but one is not forced to use one of these three methods.
      The rectangle on <m>[3,4]</m> has a height of approximately <m>f(3.53)</m>,
      very close to the Midpoint Rule.
      It was chosen so that the area of the rectangle is <em>exactly</em>
      the area of the region under <m>f</m> on <m>[3,4]</m>.
      (Later you'll be able to figure how to do this, too.)
    </p>

    <p>
      The following example will approximate the value of <m>\int_0^4 (4x-x^2)\, dx</m> using these rules.
    </p>

    <example xml:id="ex_rie2">
      <title>Using the Left Hand, Right Hand and Midpoint Rules</title>
      <statement>
        <p>
          Approximate the value of <m>\int_0^4 (4x-x^2)\, dx</m> using the Left Hand Rule,
          the Right Hand Rule,
          and the Midpoint Rule, using 4 equally spaced subintervals.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="qn8Q1i8s5Ng" xml:id="vid_int_rie_approx" component="video"/>
      </solution>
      <solution>

        <p>
          We break the interval <m>[0,4]</m> into four subintervals as before.
          In <xref ref="fig_rie2a">Figure</xref>
          we see 4 rectangles drawn on
          <m>f(x) = 4x-x^2</m> using the Left Hand Rule.
          (The areas of the rectangles are given in each figure.)
        </p>

        <p>
          Note how in the first subinterval,
          <m>[0,1]</m>, the rectangle has height <m>f(0)=0</m>.
          We add up the areas of each rectangle (height<times/> width) for our Left Hand Rule approximation:
          <md>
            <mrow>\amp f(0)\cdot 1 + f(1)\cdot 1+ f(2)\cdot 1+f(3)\cdot 1</mrow>
            <mrow>=\amp 0+3+4+3 = 10</mrow>
          </md>.
        </p>

        <p>
          <xref ref="fig_rie2b">Figure</xref>
          shows 4 rectangles drawn under <m>f</m> using the Right Hand Rule;
          note how the <m>[3,4]</m> subinterval has a rectangle of height 0.
        </p>

        <p>
          In this example,
          these rectangles seem to be the mirror image of those found in <xref ref="fig_rie2a">Figure</xref>.
          This is because of the symmetry of our shaded region.
          Our approximation gives the same answer as before,
          though calculated a different way:
          <md>
            <mrow>\amp f(1)\cdot 1 + f(2)\cdot 1+ f(3)\cdot 1+f(4)\cdot 1</mrow>
            <mrow>\amp =3+4+3+0= 10</mrow>
          </md>.
        </p>

        <p>
          <xref ref="fig_rie2c">Figure</xref>
          shows 4 rectangles drawn under <m>f</m> using the Midpoint Rule.
        </p>

        <p>
          This gives an approximation of <m>\int_0^4(4x-x^2)\, dx</m> as:
          <md>
            <mrow>f(0.5)\cdot 1 + f(1.5)\cdot 1+ f(2.5)\cdot 1 \amp +f(3.5)\cdot 1</mrow>
            <mrow>\amp =1.75+3.75+3.75+1.75 = 11</mrow>
          </md>.
        </p>

        <p>
          Our three methods provide two approximations of <m>\int_0^4(4x-x^2)\, dx</m>: 10 and 11.
        </p>
        <figure xml:id="fig_rie2">
          <caption>Approximating <m>\int_0^4(4x-x^2)\, dx</m> in <xref ref="ex_rie2">Example</xref></caption>
          <sidebyside widths="31% 31% 31%" margins="0%">
          <figure xml:id="fig_rie2a">
          <caption>using the Left Hand Rule</caption>
          <!-- START figures/fig_rie2a.tex -->
          <image xml:id="img_rie2a" width="47%">
            <description></description>
            <latex-image>

            \begin{tikzpicture}

            \begin{axis}[
            axis on top,
            xtick={1,2,3,4},
            ytick={1,2,3,4},
            ymin=-1,ymax=5,
            xmin=-.5,xmax=4.5
            ]

            \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2};
            \addplot [firstcurvestyle,-,domain=0:4,samples=40] {4*x-x^2};

            \draw [thick,secondcolor] (axis cs:0,0) rectangle (axis cs:1,0);
            \draw [thick,secondcolor] (axis cs:1,0) rectangle (axis cs:2,3);
            \draw [thick,secondcolor] (axis cs:2,0) rectangle (axis cs:3,4);
            \draw [thick,secondcolor] (axis cs:3,0) rectangle (axis cs:4,3);

            \draw [fill=black] (axis cs:0,0) circle (1pt);
            \draw [fill=black] (axis cs:1,3) circle (1pt);
            \draw [fill=black] (axis cs:2,4) circle (1pt);
            \draw [fill=black] (axis cs:3,3) circle (1pt);

            \draw (axis cs:.5,.3) node {$0$};
            \draw (axis cs:1.5,1.5) node {$3$};
            \draw (axis cs:2.5,2) node {$4$};
            \draw (axis cs:3.5,1.5) node {$3$};
            \end{axis}

            \end{tikzpicture}

            </latex-image>
          </image>
          <!-- figures/fig_rie2a.tex END -->
        </figure>

        <figure xml:id="fig_rie2b">
          <caption>using the Right Hand Rule</caption>
          <!-- START figures/fig_rie2b.tex -->
          <image xml:id="img_rie2b" width="47%">
            <description></description>
            <latex-image>

            \begin{tikzpicture}

            \begin{axis}[
            axis on top,
            xtick={1,2,3,4},
            ytick={1,2,3,4},
            ymin=-1,ymax=5,
            xmin=-.5,xmax=4.5
            ]

            \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2};
            \addplot [firstcurvestyle,-,domain=0:4,samples=40] {4*x-x^2};

            \draw [thick,secondcolor] (axis cs:0,0) rectangle (axis cs:1,3);
            \draw [thick,secondcolor] (axis cs:1,0) rectangle (axis cs:2,4);
            \draw [thick,secondcolor] (axis cs:2,0) rectangle (axis cs:3,3);
            \draw [thick,secondcolor] (axis cs:3,0) rectangle (axis cs:4,0);

            \draw [fill=black] (axis cs:4,0) circle (1pt);
            \draw [fill=black] (axis cs:1,3) circle (1pt);
            \draw [fill=black] (axis cs:2,4) circle (1pt);
            \draw [fill=black] (axis cs:3,3) circle (1pt);

            \draw (axis cs:.5,1.5) node {$3$};
            \draw (axis cs:1.5,2) node {$4$};
            \draw (axis cs:2.5,1.5) node {$3$};
            \draw (axis cs:3.5,.3) node {$0$};
            \end{axis}

            \end{tikzpicture}

            </latex-image>
          </image>
          <!-- figures/fig_rie2b.tex END -->
        </figure>

        <figure xml:id="fig_rie2c">
          <caption>using the Midpoint Rule</caption>
          <!-- START figures/fig_rie2c.tex -->
          <image xml:id="img_rie2c" width="47%">
            <description></description>
            <latex-image>

            \begin{tikzpicture}

            \begin{axis}[
            axis on top,
            xtick={1,2,3,4},
            ytick={1,2,3,4},
            ymin=-1,ymax=5,
            xmin=-.5,xmax=4.5
            ]

            \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2};
            \addplot [firstcurvestyle,-,domain=0:4,samples=40] {4*x-x^2};

            \draw [thick,secondcolor] (axis cs:0,0) rectangle (axis cs:1,1.75);
            \draw [thick,secondcolor] (axis cs:1,0) rectangle (axis cs:2,3.75);
            \draw [thick,secondcolor] (axis cs:2,0) rectangle (axis cs:3,3.75);
            \draw [thick,secondcolor] (axis cs:3,0) rectangle (axis cs:4,1.75);

            \draw [fill=black] (axis cs:.5,1.75) circle (1pt);
            \draw [fill=black] (axis cs:1.5,3.75) circle (1pt);
            \draw [fill=black] (axis cs:2.5,3.75) circle (1pt);
            \draw [fill=black] (axis cs:3.5,1.75) circle (1pt);

            \draw (axis cs:.5,.875) node {\small $1.75$};
            \draw (axis cs:1.5,1.875) node {\small $3.75$};
            \draw (axis cs:2.5,1.875) node {\small $3.75$};
            \draw (axis cs:3.5,.875) node {\small $1.75$};
            \end{axis}

            \end{tikzpicture}

            </latex-image>
          </image>
          <!-- figures/fig_rie2c.tex END -->
        </figure>

          </sidebyside>
        </figure>
      </solution>
    </example>
  </introduction>

  <subsection xml:id="fig_rie_notation">
    <title>Summation Notation</title>
    <p>
      It is hard to tell at this moment which is a better approximation: 10 or 11?
      We can continue to refine our approximation by using more rectangles.
      The notation can become unwieldy,
      though, as we add up longer and longer lists of numbers.
      We introduce <em>summation notation</em>
      to ameliorate this problem.
          <idx><h>summation</h><h>notation</h></idx>
    </p>

    <figure xml:id="vid_int_rie_sum_not" component="video">
      <caption>Explaining summation notation</caption>
      <video youtube="d0gSFClfRdY"/>
    </figure>


    <p>
      Suppose we wish to add up a list of numbers <m>a_1</m>,
      <m>a_2</m>,
      <m>a_3</m>, <ellipsis/>, <m>a_9</m>.
      Instead of writing
      <me>
        a_1+a_2+a_3+a_4+a_5+a_6+a_7+a_8+a_9
      </me>,
      we use summation notation and write <m>\sum_{i=1}^9 a_i</m>.
<!--ToDo: original has a diagram for this, named fig_rie_notation. Why not include here?-->
      The upper case sigma,
      <m>Sigma</m> represents the term <q>sum</q>. The index (counter) of summation in this example is <m>i</m>; any symbol can be used.
      By convention, the index takes on only the integer values between
      (and including)
      the lower and upper bounds.
      To the right of <m>\Sigma</m>,
      the expression <m>a_i</m> is called the summand.
      It tells us what we are summing.
      This is summarized in <xref ref="eq_sigmanotation">Equation</xref>.
      <men xml:id="eq_sigmanotation">
        \sum_{\underbrace{i=1}_{i \text{-index of summation}}}^{\overbrace{9}^\text{upper bound}} \underbrace{a_i}_\text{summand}
      </men>
    </p>

    <p>
      Let's practice using this notation.
    </p>

    <example xml:id="ex_rie3">
      <title>Using summation notation</title>
      <statement>
        <p>
          Let the numbers <m>\{a_i\}</m> be defined as
          <m>a_i = 2i-1</m> for integers <m>i</m>, where <m>i\geq 1</m>.
          So <m>a_1 = 1</m>, <m>a_2 = 3</m>,
          <m>a_3 = 5</m>, etc. (The output is the positive odd integers).
          Evaluate the following summations:

          <ol>
            <li><m>\sum_{i=1}^6 a_i </m></li>

            <li><m>\sum_{i=3}^7 (3a_i-4) </m></li>

            <li><m>\sum_{i=1}^4 (a_i)^2 </m></li>
          </ol>
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="GKaRI_a96-Q" xml:id="vid_int_rie_sum_ex" component="video"/>
      </solution>
      <solution>

        <p>
          <ol>
            <li>
              <p>
                <md>
                  <mrow>\sum_{i=1}^6 a_i \amp = a_1+a_2+a_3+a_4+a_5+a_6</mrow>
                  <mrow>\amp =  1+3+5+7+9+11</mrow>
                  <mrow>\amp =  36</mrow>
                </md>.
              </p>
            </li>

            <li>
              <p>
                Note the starting value is different than 1:
                <md>
                  <mrow>\sum_{i=3}^7 (3a_i-4) \amp = (3a_3-4)+(3a_4-4)+(3a_5-4)+(3a_6-4)+(3a_7-4)</mrow>
                  <mrow>\amp = 11+17+23+29+35</mrow>
                  <mrow>\amp = 115</mrow>
                </md>.
              </p>
            </li>

            <li>
              <p>
                <md>
                  <mrow>\sum_{i=1}^4 (a_i)^2 \amp =  (a_1)^2+(a_2)^2+(a_3)^2+(a_4)^2</mrow>
                  <mrow>\amp =  1^2+3^2+5^2+7^2</mrow>
                  <mrow>\amp =  84</mrow>
                </md>.
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>

    <p>
      It might seem odd to stress a new,
      concise way of writing summations only to write each term out as we add them up.
      It is.
      The following theorem gives some of the properties of summations that allow us to work with them without writing individual terms.
      Examples will follow.
    </p>

    <theorem xml:id="thm_summation">
      <title>Properties of Summations</title>
      <statement>
          <p>
            <idx><h>summation</h><h>properties</h></idx>

            <ol cols="2">
              <li>
                <p>
                  <m>\ds \sum_{i=1}^n c = c\cdot n</m>,
                  where <m>c</m> is a constant.
                </p>
              </li>

              <li><m>\sum_{i=m}^n (a_i\pm b_i) = \sum_{i=m}^n a_i \pm \sum_{i=m}^n b_i</m></li>

              <li><m>\sum_{i=m}^n c\cdot a_i = c\cdot\sum_{i=m}^n a_i</m></li>

              <li><m>\sum_{i=m}^j a_i + \sum_{i=j+1}^n a_i = \sum_{i=m}^n a_i</m></li>

              <li><m>\sum_{i=1}^n i = \frac{n(n+1)}2</m></li>

              <li><m>\sum_{i=1}^n i^2 = \frac{n(n+1)(2n+1)}6</m></li>

              <li><m>\sum_{i=1}^n i^3 = \left(\frac{n(n+1)}2\right)^2</m></li>
            </ol>
          </p>
      </statement>
    </theorem>

    <figure xml:id="vid_int_rie_sum_prop" component="video">
      <caption>Video presentation of <xref ref="thm_summation"/></caption>
      <video youtube="w8jWl2KjOvQ"/>
    </figure>


    <example xml:id="ex_rie4">
      <title>Evaluating summations using <xref ref="thm_summation">Theorem</xref></title>
      <statement>
        <p>
          Revisit <xref ref="ex_rie3">Example</xref> and,
          using <xref ref="thm_summation">Theorem</xref>, evaluate
          <me>
            \sum_{i=1}^6 a_i = \sum_{i=1}^6 (2i-1)
          </me>.
        </p>
      </statement>
      <solution>
        <p>
          <md>
            <mrow>\sum_{i=1}^6 (2i-1) \amp  = \sum_{i=1}^6 2i - \sum_{i=1}^6 (1)</mrow>
            <mrow>\amp =  \left(2\sum_{i=1}^6 i \right)- 6</mrow>
            <mrow>\amp = 2\frac{6(6+1)}{2} - 6</mrow>
            <mrow>\amp = 42-6 = 36</mrow>
          </md>
        </p>
        <p>
          We obtained the same answer without writing out all six terms.
          When dealing with small sizes of <m>n</m>,
          it may be faster to write the terms out by hand.
          However, <xref ref="thm_summation">Theorem</xref>
          is incredibly important when dealing with large sums as we'll soon see.
        </p>
      </solution>
    </example>
  </subsection>

  <subsection>
    <title>Riemann Sums</title>
    <p>
      Consider again <m>\int_0^4(4x-x^2)\, dx</m>.
      We will approximate this definite integral using 16 equally spaced subintervals and the Right Hand Rule in <xref ref="ex_rie7">Example</xref>.
      Before doing so, it will pay to do some careful preparation.
          <idx><h>Riemann Sum</h></idx>
    </p>

    <figure xml:id="fig_rie5">
      <caption>Dividing <m>[0,4]</m> into 16 equally spaced subintervals</caption>
      <image xml:id="img_rie5" width="47%">
        <description></description>
        <latex-image>

        \begin{tikzpicture}

        \draw [&lt;-&gt;] (-.5,0) -- (4.5,0);

        \foreach \x in {0,.25,...,4} {
            \draw (\x,-.1) -- (\x,.1);
          }
        \draw (0,-.25) node {\scriptsize $0$};
        \draw (1,-.25) node {\scriptsize $1$};
        \draw (2,-.25) node {\scriptsize $2$};
        \draw (3,-.25) node {\scriptsize $3$};
        \draw (4,-.25) node {\scriptsize $4$};

        \draw (0,-.55) node {\scriptsize $x_0$};
        \draw (1,-.55) node {\scriptsize $x_4$};
        \draw (2,-.55) node {\scriptsize $x_8$};
        \draw (3,-.55) node {\scriptsize $x_{12}$};
        \draw (4,-.55) node {\scriptsize $x_{16}$};

        \end{tikzpicture}

        </latex-image>
      </image>
    </figure>

    <p>
      <xref ref="fig_rie5">Figure</xref>
      shows a number line of <m>[0,4]</m> divided,
      or <em>partitioned</em>, into 16 equally spaced subintervals.
      We denote <m>0</m> as <m>x_0</m>;
      we have marked the values of <m>x_4</m>, <m>x_8</m>,
      <m>x_{12}</m> and <m>x_{16}</m>.
      We could mark them all, but the figure would get crowded.
      While it is easy to figure that <m>x_{9} = 2.25</m>, in general,
      we want a method of determining the value of <m>x_i</m> without consulting the figure.
      Consider:
    </p>

    <image xml:id="img_rie5a" width="35%">
      <description></description>
      <latex-image>

      \begin{tikzpicture}
      \draw (1.5,1) node {$\displaystyle x_i = x_0 + i\Delta x$};

      \draw [firstcolor] (1,0) node [text width=32pt,align=center] (a) { \centering starting\\[-5pt] value};
      \draw [firstcolor,-&gt;] (a) -- (.95,.75);

      \draw [firstcolor] (2,2.5) node [text width=120pt,align=center] (b) { \centering number of subintervals\\[-5pt] between $x_0$ and $x_i$};
      \draw [firstcolor,-&gt;] (b) -- (1.95,1.25);

      \draw [firstcolor] (3,0) node [text width=60pt,align=center] (c) { \centering subinterval\\[-5pt] size};
      \draw [firstcolor,-&gt;] (c) -- (2.75,.75);

      \end{tikzpicture}

      </latex-image>
    </image>

    <p>
      So <m>x_{9} = x_0 + 9(4/16) = 2.25</m>.
    </p>

    <p>
      If we had partitioned <m>[0,4]</m> into 100 equally spaced subintervals,
      each subinterval would have length <m>\Delta x=4/100 = 0.04</m>.
      We could compute <m>x_{31}</m> as
      <me>
        x_{31} = x_0 + 31(4/100) = 1.24
      </me>.
    </p>

    <p>
      (That was far faster than creating a sketch first.)
    </p>

    <p>
      Given any subdivision of <m>[0,4]</m>,
      the first subinterval is <m>[x_0,x_1]</m>;
      the second is <m>[x_1,x_2]</m>;
      the <m>i</m>th subinterval is <m>[x_{i-1},x_{i}]</m>.
    </p>

    <p>
      When using the Left Hand Rule,
      the height of the <m>i</m>th rectangle will be <m>f(x_{i-1})</m>.
    </p>

    <p>
      When using the Right Hand Rule,
      the height of the <m>i</m>th rectangle will be <m>f(x_{i})</m>.
    </p>

    <p>
      When using the Midpoint Rule,
      the height of the <m>i</m>th rectangle will be <m>\ds f\left(\frac{x_{i-1}+x_{i}}2\right)</m>.
    </p>

    <p>
      Thus approximating <m>\int_0^4(4x-x^2)\, dx</m> with 16 equally spaced subintervals can be expressed as follows,
      where <m>\Delta x = 4/16 = 1/4</m>:
    </p>

    <p>
      <dl>
        <li>
          <title>Left Hand Rule</title>
          <p>
            <m>\ds \sum_{i=1}^{16} f(x_{i-1})\Delta x</m>
          </p>
        </li>

        <li>
          <title>Right Hand Rule</title>
          <p>
            <m>\ds \sum_{i=1}^{16} f(x_{i})\Delta x</m>
          </p>
        </li>

        <li>
          <title>Midpoint Rule</title>
          <p>
            <m>\ds \sum_{i=1}^{16} f\left(\frac{x_{i-1}+x_{i}}2\right)\Delta x</m>
          </p>
        </li>
      </dl>
          <idx><h>Left Hand Rule</h></idx>
          <idx><h>Right Hand Rule</h></idx>
          <idx><h>Midpoint Rule</h></idx>
    </p>

    <p>
      We use these formulas in the next two examples.
      The following example lets us practice using the Right Hand Rule and the summation formulas introduced in <xref ref="thm_summation">Theorem</xref>.
    </p>

    <example xml:id="ex_rie7">
      <title>Approximating definite integrals using sums</title>
      <statement>
        <p>
          Approximate <m>\int_0^4(4x-x^2)\, dx</m> using the Right Hand Rule and summation formulas with 16 and 1000 equally spaced intervals.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="urkFFBmu9uQ" xml:id="vid_int_rie_ex_1" component="video"/>
      </solution>
      <solution>

        <p>
          Using the formula derived before,
          using 16 equally spaced intervals and the Right Hand Rule,
          we can approximate the definite integral as
          <me>
            \sum_{i=1}^{16}f(x_{i})\Delta x
          </me>.
        </p>

        <p>
          We have <m>\Delta x = 4/16 = 0.25</m>.
          Since <m>x_i = 0+i\Delta x</m>, we have
          <me>
            x_{i} = 0 + i\Delta x = i\Delta x
          </me>.
        </p>

        <p>
          Using the summation formulas, consider:
          <mdn>
            <mrow number="no">\int_0^4 (4x-x^2)\, dx \amp \approx \sum_{i=1}^{16} f(x_{i})\Delta x</mrow>
            <mrow number="no">\amp = \sum_{i=1}^{16} f(i\Delta x) \Delta x</mrow>
            <mrow number="no">\amp = \sum_{i=1}^{16} \big(4i\Delta x - (i\Delta x)^2\big)\Delta x</mrow>
            <mrow number="no">\amp = \sum_{i=1}^{16} (4i\Delta x^2 - i^2\Delta x^3)</mrow>
            <mrow xml:id="eq_rie7">\amp = (4\Delta x^2)\sum_{i=1}^{16} i - \Delta x^3 \sum_{i=1}^{16} i^2</mrow>
            <mrow number="no">\amp = (4\Delta x^2)\frac{16\cdot 17}{2} - \Delta x^3 \frac{16(17)(33)}6</mrow>
            <mrow number="no">\amp =	4\cdot 0.25^2\cdot 136-0.25^3\cdot 1496</mrow>
            <mrow number="no">\amp =10.625</mrow>
          </mdn>
        </p>

        <p>
          We were able to sum up the areas of 16 rectangles with very little computation.
          In <xref ref="fig_rie7">Figure</xref>
          the function and the 16 rectangles are graphed.
          While some rectangles over-approximate the area,
          other under-approximate the area
          (by about the same amount).
          Thus our approximate area of 10.625 is likely a fairly good approximation.
        </p>

        <p>
          Notice Equation <xref ref="eq_rie7"/>;
          by replacing 16 by 1,000
          (and appropriately changing the value of <m>\Delta x</m>),
          we can use that equation to sum up 1000 rectangles!
        </p>

        <figure xml:id="fig_rie7">
          <caption>Approximating <m>\int_0^4(4x-x^2)\, dx</m> with the Right Hand Rule and 16 evenly spaced subintervals</caption>
          <!-- START figures/fig_rie7.tex -->
          <image xml:id="img_rie7" width="47%">
            <description></description>
            <latex-image>

            \begin{tikzpicture}

            \begin{axis}[
            axis on top,
            xtick={1,2,3,4},
            ytick={1,2,3,4},
            ymin=-1,ymax=5,
            xmin=-.5,xmax=4.5
            ]

            \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2};
            \addplot [firstcurvestyle,-,domain=0:4,samples=40] {4*x-x^2};

            \foreach \x / \y in {0.25 / 0.9375, 0.5 / 1.75, 0.75 / 2.4375, 1. / 3., 1.25 / 3.4375,
              1.5 / 3.75, 1.75 / 3.9375, 2. / 4., 2.25 / 3.9375, 2.5 / 3.75,
              2.75 /3.4375, 3. / 3., 3.25 / 2.4375, 3.5 / 1.75, 3.75 / 0.9375, 4. / 0.}
            {\addplot [thick,secondcolor] coordinates {(\x-.25,0) (\x-.25,\y) (\x,\y) (\x,0) (\x-.25,0)};
            }

            \end{axis}

            \end{tikzpicture}

            </latex-image>
          </image>
          <!-- figures/fig_rie7.tex END -->
        </figure>

        <p>
          We do so here,
          skipping from the original summand to the equivalent of Equation <xref ref="eq_rie7"/> to save space.
          Note that <m>\Delta x = 4/1000 = 0.004</m>.
          <md>
            <mrow>\int_0^4 (4x-x^2)\, dx \amp \approx \sum_{i=1}^{1000} f(x_{i})\Delta x</mrow>
            <mrow>\amp = (4\Delta x^2)\sum_{i=1}^{1000} i - \Delta x^3 \sum_{i=1}^{1000} i^2</mrow>
            <mrow>\amp = (4\Delta x^2)\frac{1000\cdot 1001}{2} - \Delta x^3 \frac{1000(1001)(2001)}6</mrow>
            <mrow>\amp =10.666656</mrow>
          </md>
        </p>

        <p>
          Using many, many rectangles, we have a likely good approximation of
          <m>\int_0^4 (4x-x^2)\dx</m>.
          That is,
          <me>
            \int_0^4(4x-x^2)\, dx \approx 10.666656
          </me>.
        </p>
      </solution>
    </example>

    <p>
      Before the above example,
      we stated what the summations for the Left Hand, Right Hand and Midpoint Rules looked like.
      Each had the same basic structure, which was:
    </p>

    <p>
      <ol>
        <li>
          <p>
            each rectangle has the same width,
            which we referred to as <m>\Delta x</m>, and
          </p>
        </li>

        <li>
          <p>
            each rectangle's height is determined by evaluating <m>f</m> at a particular point in each subinterval.
            For instance,
            the Left Hand Rule states that each rectangle's height is determined by evaluating <m>f</m> at the left hand endpoint of the subinterval the rectangle lives on.
          </p>
        </li>
      </ol>
    </p>

    <p>
      One could partition an interval <m>[a,b]</m> with subintervals that do not have the same size.
      We refer to the length of the
      <m>i</m>th subinterval as <m>\Delta x_i</m>.
      Also, one could determine each rectangle's height by evaluating <m>f</m> at <em>any</em>
      point <m>c_i</m> in the <m>i</m>th subinterval.
      Thus the height of the <m>i</m>th subinterval would be <m>f(c_i)</m>,
      and the area of the <m>i</m>th rectangle would be <m>f(c_i)\Delta x_i</m>.
      These ideas are formally defined below.
    </p>

    <definition xml:id="def_partition">
      <title>Partition</title>
      <statement>
        <p>
          A <term>partition</term> <m>\Delta x</m> of a closed interval <m>[a,b]</m> is a set of numbers <m>x_0</m>,
          <m>x_1</m>,
          <m>\ldots</m> <m>x_{n}</m> where
          <me>
            a=x_0 \lt  x_1 \lt  \ldots \lt  x_{n-1} \lt  x_{n}=b
          </me>.
        </p>

        <p>
          The length of the <m>i</m>th subinterval,
          <m>[x_{i-1},x_{i}]</m>, is <m>\Delta x_i = x_{i}-x_{i-1}</m>.
          If <m>[a,b]</m> is partitioned into subintervals of equal length,
          we let <m>\Delta x</m> represent the length of each subinterval.
        </p>

        <p>
          The <term>size of the partition</term>,
          denoted <m>\norm{\Delta x}</m>,
          is the length of the largest subinterval of the partition.
              <idx><h>partition</h></idx>
              <idx><h>partition</h><h>size of</h></idx>
        </p>
      </statement>
    </definition>

    <figure xml:id="vid_int_rie_partns" component="video">
      <caption>Video presentation of <xref ref="def_partition"/></caption>
      <video youtube="2iw1Mh4iJ0I"/>
    </figure>


    <p>
      Summations of rectangles with area
      <m>f(c_i)\Delta x_i</m> are named after mathematician Georg Friedrich Bernhard Riemann,
      as given in the following definition.
    </p>

    <definition xml:id="def_rie_sum">
      <title>Riemann Sum</title>
      <statement>
        <p>
          Let <m>f</m> be defined on a closed interval <m>[a,b]</m>,
          let <m>\Delta x</m> be a partition of <m>[a,b]</m>
          as given in <xref ref="def_partition">Definition</xref>,
              <idx><h>Riemann Sum</h></idx>
          and let <m>c_i</m> denote any value in the <m>i</m>th subinterval.
        </p>

        <p>
          The sum
          <me>
            \sum_{i=1}^n f(c_i)\Delta x_i
          </me>
          is a <term>Riemann sum</term> of <m>f</m> on <m>[a,b]</m>.
        </p>
      </statement>
    </definition>

    <figure xml:id="vid_int_rie_defn" component="video">
      <caption>Video presentation of <xref ref="def_rie_sum"/></caption>
      <video youtube="1ZxKyf4JSS4"/>
    </figure>


    <p>
      <xref ref="fig_riedef">Figure</xref>
      shows the approximating rectangles of a Riemann sum of <m>\int_0^4(4x-x^2)\, dx</m>.
      While the rectangles in this example do not approximate well the shaded area,
      they demonstrate that the subinterval widths may vary and the heights of the rectangles can be determined without following a particular rule.
    </p>

    <figure xml:id="fig_riedef">
      <caption>An example of a general Riemann sum to approximate <m>\int_0^4(4x-x^2)\, dx</m></caption>
      <!-- START figures/fig_riedef.tex -->
      <image xml:id="img_riedef" width="47%">
        <description></description>
        <latex-image>

        \begin{tikzpicture}

        \begin{axis}[
        axis on top,
        xtick={1,2,3,4},
        ytick={1,2,3,4},
        ymin=-1,ymax=5,
        xmin=-.5,xmax=4.5
        ]

        \addplot [firstcurvestyle,areastyle,domain=0:4] {4*x-x^2};
        \addplot [firstcurvestyle,-,domain=0:4,samples=40] {4*x-x^2};

        \draw [thick,secondcolor] (axis cs:0,0) rectangle (axis cs:2,.9375);
        \draw [thick,secondcolor] (axis cs:2,0) rectangle (axis cs:3.5,2.79);
        \draw [thick,secondcolor] (axis cs:3.5,0) rectangle (axis cs:4,.76);
        \draw [fill=black] (axis cs:.25,.9375) circle (1pt);
        \draw [fill=black] (axis cs:3.1,2.79) circle (1pt);
        \draw [fill=black] (axis cs:3.8,.76) circle (1pt);

        \end{axis}

        \end{tikzpicture}

        </latex-image>
      </image>
      <!-- figures/fig_riedef.tex END -->
    </figure>

    <p>
      <q>Usually</q> Riemann sums are calculated using one of the three methods we have introduced.
      The uniformity of construction makes computations easier.
      Before working another example,
      let's summarize some of what we have learned in a convenient way.
    </p>

    <insight xml:id="idea_riemann">
      <title>Riemann Sum Concepts</title>
      <p>
        Consider <m>\ds \int_a^b f(x) \, dx \approx \sum_{i=1}^n f(c_i)\Delta x_i</m>.
      </p>

      <p>
        <ol>
          <li>
            <p>
              When the <m>n</m> subintervals have equal length,
              <m>\ds \Delta x_i = \Delta x = \frac{b-a}n</m>.
            </p>
          </li>

          <li>
            <p>
              The <m>i</m>th term of an equally spaced partition is <m>x_i = a + i\Delta x</m>.
              (Thus <m>x_0=a</m> and <m>x_{n} = b</m>.)
            </p>
          </li>

          <li>
            <p>
              The Left Hand Rule summation is:
              <m>\ds \sum_{i=1}^n f(x_{i-1})\Delta x</m>.
            </p>
          </li>

          <li>
            <p>
              The Right Hand Rule summation is:
              <m>\ds \sum_{i=1}^n f(x_{i})\Delta x</m>.
            </p>
          </li>

          <li>
            <p>
              The Midpoint Rule summation is:
              <m>\ds \sum_{i=1}^n f\left(\frac{x_{i-1}+x_{i}}{2}\right)\Delta x</m>.
            </p>
          </li>
        </ol>
      </p>
    </insight>

    <p>
      Let's do another example.
    </p>

    <example xml:id="ex_rie8">
      <title>Approximating definite integrals with sums</title>
      <statement>
        <p>
          Approximate <m>\int_{-2}^3 (5x+2)\, dx</m> using the Midpoint Rule and 10 equally spaced intervals.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="O6S1f6-D8Ls" xml:id="vid_int_rie_ex_2" component="video"/>
      </solution>
      <solution>

        <p>
          Following <xref ref="idea_riemann">Key Idea</xref>, we have
          <me>
            \Delta x = \frac{3 - (-2)}{10} = 1/2  \text{ and }   x_i = (-2) + (1/2)(i) = i/2-2
          </me>.
        </p>

        <p>
          As we are using the Midpoint Rule,
          we will also need <m>x_{i-1}</m> and <m>\ds \frac{x_{i-1}+x_{i}}2</m>.
          Since <m>x_i = i/2-2</m>,<m>x_{i-1} = (i-1)/2 - 2 = i/2 -5/2</m>.
          This gives
          <me>
            \frac{x_{i-1}+x_{i}}2 = \frac{(i/2-5/2) + (i/2-2)}{2} = \frac{i-9/2}{2} = i/2 - 9/4
          </me>.
        </p>

        <p>
          We now construct the Riemann sum and compute its value using summation formulas.
          <md>
            <mrow>\int_{-2}^3 (5x+2)\, dx   \amp \approx \sum_{i=1}^{10} f\left(\frac{x_{i-1}+x_{i}}{2}\right)\Delta x</mrow>
            <mrow>\amp =  \sum_{i=1}^{10} f(i/2 - 9/4)\Delta x</mrow>
            <mrow>\amp =  \sum_{i=1}^{10} \big(5(i/2-9/4) + 2\big)\Delta x</mrow>
            <mrow>\amp =  \Delta x\sum_{i=1}^{10}\left[\left(\frac{5}{2}\right)i - \frac{37}{4}\right]</mrow>
            <mrow>\amp =  \Delta x\left(\frac{5}2\sum_{i=1}^{10} (i) - \sum_{i=1}^{10}\left(\frac{37}{4}\right)\right)</mrow>
            <mrow>\amp = \frac12\left(\frac52\cdot\frac{10(11)}{2} - 10\cdot\frac{37}4\right)</mrow>
            <mrow>\amp = \frac{45}2 = 22.5</mrow>
          </md>
        </p>

        <figure xml:id="fig_rie8">
          <caption>Approximating <m>\int_{-2}^3 (5x+2)\, dx</m> using the Midpoint Rule and 10 evenly spaced subintervals in <xref ref="ex_rie8">Example</xref></caption>
          <!-- START figures/fig_rie8.tex -->
          <image xml:id="img_rie8" width="47%">
            <description></description>
            <latex-image>

            \begin{tikzpicture}

            \begin{axis}[
            axis on top,
            xtick={-2,-1,1,2,3},
            ytick={10,17,-8},
            ymin=-9,ymax=19,
            xmin=-2.5,xmax=3.5
            ]

            \addplot [firstcurvestyle,areastyle,domain=-2:3] {5*x+2} \closedcycle;
            \addplot [firstcurvestyle,-,domain=-2:3] {5*x+2};

            \foreach \x / \y in {-1.75 / -6.75, -1.25 / -4.25, -0.75 / -1.75, -0.25 / 0.75,
            0.25 /3.25, 0.75 / 5.75, 1.25 / 8.25, 1.75 / 10.75, 2.25 / 13.25,
            2.75 /15.75}
            {\addplot [thick,secondcolor] coordinates {(\x-.25,0) (\x-.25,\y) (\x+.25,\y) (\x+.25,0) (\x-.25,0)};
            }
            \end{axis}

            \end{tikzpicture}

            </latex-image>
          </image>
          <!-- figures/fig_rie8.tex END -->
        </figure>

        <p>
          Note the graph of <m>f(x) = 5x+2</m> in <xref ref="fig_rie8">Figure</xref>.
          The regions whose area is computed by the definite integral are triangles,
          meaning we can find the exact answer without summation techniques.
          We find that the exact answer is indeed 22.5.
          One of the strengths of the Midpoint Rule is that often each rectangle includes area that should not be counted,
          but misses other area that should.
          When the partition size is small,
          these two amounts are about equal and these errors almost
          <q>cancel each other out.</q> In this example,
          since our function is a line,
          these errors are exactly equal and they do cancel each other out,
          giving us the exact answer.
        </p>

        <p>
          Note too that when the function is negative,
          the rectangles have a <q>negative</q> height.
          When we compute the area of the rectangle,
          we use <m>f(c_i)\Delta x</m>;
          when <m>f</m> is negative, the area is counted as negative.
        </p>
      </solution>
    </example>

    <p>
      Notice in the previous example that while we used 10 equally spaced intervals,
      the number <q>10</q> didn't play a big role in the calculations until the very end.
      Mathematicians love to abstract ideas;
      let's approximate the area of another region using <m>n</m> subintervals,
      where we do not specify a value of <m>n</m> until the very end.
    </p>

    <example xml:id="ex_rie9">
      <title>Approximating definite integrals with a formula, using sums</title>
      <statement>
        <p>
          Revisit <m>\int_0^4(4x-x^2)\, dx</m> yet again.
          Approximate this definite integral using the Right Hand Rule with <m>n</m> equally spaced subintervals.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="LjMZOVNdRxQ" xml:id="vid_int_rie_ex_n_rect" component="video"/>
      </solution>
      <solution>

        <p>
          Using <xref ref="idea_riemann">Key Idea</xref>,
          we know <m>\Delta x = \frac{4-0}{n} = 4/n</m>.
          We also find <m>x_i = 0 + i\Delta x = 4i/n</m>.
        </p>

        <p>
          We construct the Right Hand Rule Riemann sum as follows.
          Be sure to follow each step carefully.
          If you get stuck,
          and do not understand how one line proceeds to the next,
          you may skip to the result and consider how this result is used.
          You should come back, though,
          and work through each step for full understanding.
          <md>
            <mrow>\int_0^4(4x-x^2)\, dx \amp \approx \sum_{i=1}^n f(x_{i})\Delta x</mrow>
            <mrow>\amp = \sum_{i=1}^n f\left(\frac{4i}{n}\right) \Delta x</mrow>
            <mrow>\amp =  \sum_{i=1}^n \left[4\frac{4i}n-\left(\frac{4i}n\right)^2\right]\Delta x</mrow>
            <mrow>\amp =  \sum_{i=1}^n \left(\frac{16\Delta x}{n}\right)i - \sum_{i=1}^n \left(\frac{16\Delta x}{n^2}\right)i^2</mrow>
            <mrow>\amp =  \left(\frac{16\Delta x}{n}\right)\sum_{i=1}^n i - \left(\frac{16\Delta x}{n^2}\right)\sum_{i=1}^n i^2</mrow>
            <mrow>\amp = \left(\frac{16\Delta x}{n}\right)\cdot \frac{n(n+1)}{2} - \left(\frac{16\Delta x}{n^2}\right)\frac{n(n+1)(2n+1)}{6}</mrow>
            <mrow>\amp =\frac{32(n+1)}{n} - \frac{32(n+1)(2n+1)}{3n^2}  (\text{ recall } \Delta x = 4/n)</mrow>
            <mrow>\amp = \frac{32}{3}\left(1-\frac{1}{n^2}\right) \text{ (after simplifying) }</mrow>
          </md>
        </p>

        <p>
          The result is an amazing, easy to use formula.
          To approximate the definite integral with 10 equally spaced subintervals and the Right Hand Rule,
          set <m>n=10</m> and compute
          <me>
            \int_0^4 (4x-x^2)\, dx \approx \frac{32}{3}\left(1-\frac{1}{10^2}\right) = 10.56
          </me>.
        </p>

        <p>
          Recall how earlier we approximated the definite integral with 4 subintervals;
          with <m>n=4</m>, the formula gives 10, our answer as before.
        </p>

        <p>
          It is now easy to approximate the integral with 1,000,000 subintervals!
          Hand-held calculators will round off the answer a bit prematurely giving an answer of <m>10.66666667</m>.
          (The actual answer is <m>10.666666666656</m>.)
        </p>

        <p>
          We now take an important leap.
          Up to this point,
          our mathematics has been limited to geometry and algebra
          (finding areas and manipulating expressions).
          Now we apply <em>calculus</em>.
          For any <em>finite</em> <m>n</m>, we know that
          <me>
            \int_0^4 (4x-x^2)\, dx \approx \frac{32}{3}\left(1-\frac{1}{n^2}\right)
          </me>.
        </p>

        <p>
          Both common sense and high-level mathematics tell us that as <m>n</m> gets large,
          the approximation gets better.
          In fact, if we take the <em>limit</em>
          as <m>n\rightarrow \infty</m>,
          we get the <em>exact area</em> described by <m>\int_0^4 (4x-x^2)\, dx</m>.
          That is,
          <md>
            <mrow>\int_0^4 (4x-x^2)\, dx \amp = \lim_{n\rightarrow \infty} \frac{32}{3}\left(1-\frac{1}{n^2}\right)</mrow>
            <mrow>\amp = \frac{32}{3}\left(1-0\right)</mrow>
            <mrow>\amp = \frac{32}{3} = 10.\overline{6}</mrow>
          </md>
        </p>

        <p>
          This is a fantastic result.
          By considering <m>n</m> equally-spaced subintervals,
          we obtained a formula for an approximation of the definite integral that involved our variable <m>n</m>.
          As <m>n</m> grows large <mdash/> without bound <mdash/> the error shrinks to zero and we obtain the exact area.
        </p>
      </solution>
    </example>

    <p>
      This section started with a fundamental calculus technique:
      make an approximation, refine the approximation to make it better,
      then use limits in the refining process to get an exact answer.
      That is precisely what we just did.
    </p>

    <p>
      Let's practice this again.
    </p>

    <example xml:id="ex_rie10">
      <title>Approximating definite integrals with a formula, using sums</title>
      <statement>
        <p>
          Find a formula that approximates
          <m>\int_{-1}^5 x^3\, dx</m> using the Right Hand Rule and <m>n</m> equally spaced subintervals,
          then take the limit as <m>n\to\infty</m> to find the exact area.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="yvWSszI0Xvc" xml:id="vid_int_rie_ex_lim" component="video"/>
      </solution>
      <solution>

        <p>
          Following <xref ref="idea_riemann">Key Idea</xref>,
          we have <m>\Delta x = \frac{5-(-1)}{n} = 6/n</m>.
          We have <m>x_i = (-1) + i\Delta x</m>,
          which is the right endpoint of the <m>i</m>th subinterval.
        </p>

        <p>
          The Riemann sum corresponding to the Right Hand Rule is (followed by simplifications):
          <md>
            <mrow>\int_{-1}^5 x^3\, dx   \amp \approx \sum_{i=1}^n f(x_{i})\Delta x</mrow>
            <mrow>\amp = \sum_{i=1}^n f(-1+i\Delta x)\Delta x</mrow>
            <mrow>\amp = \sum_{i=1}^n (-1+i\Delta x)^3\Delta x</mrow>
            <mrow>\amp = \sum_{i=1}^n \big((i\Delta x)^3 -3(i\Delta x)^2 + 3i\Delta x -1\big)\Delta x  \text{ (now distribute \(\Delta x\)) }</mrow>
            <mrow>\amp = \sum_{i=1}^n \big(i^3\Delta x^4 - 3i^2\Delta x^3 + 3i\Delta x^2 -\Delta x\big)  \text{ (now split up summation) }</mrow>
            <mrow>\amp = \Delta x^4 \sum_{i=1}^ni^3 -3\Delta x^3 \sum_{i=1}^n i^2+ 3\Delta x^2 \sum_{i=1}^n i - \sum_{i=1}^n \Delta x</mrow>
            <mrow>\amp = \Delta x^4 \left(\frac{n(n+1)}{2}\right)^2 -3\Delta x^3 \frac{n(n+1)(2n+1)}{6}+ 3\Delta x^2 \frac{n(n+1)}{2} - n\Delta x</mrow>
            <intertext>(use <m>\Delta x = 6/n</m>)</intertext>
            <mrow>\amp = \frac{1296}{n^4}\cdot\frac{n^2(n+1)^2}{4} - 3\frac{216}{n^3}\cdot\frac{n(n+1)(2n+1)}{6} + 3\frac{36}{n^2}\frac{n(n+1)}2 -6</mrow>
            <intertext>(now do a sizable amount of algebra to simplify)</intertext>
            <mrow>\amp =156 + \frac{378}n + \frac{216}{n^2}</mrow>
          </md>
        </p>

        <p>
          Once again, we have found a compact formula for approximating the definite integral with <m>n</m> equally spaced subintervals and the Right Hand Rule.
          Using 10 subintervals, we have an approximation of <m>195.96</m>
          (these rectangles are shown in <xref ref="fig_rie9">Figure</xref>).
          Using <m>n=100</m> gives an approximation of <m>159.802</m>.
        </p>

        <figure xml:id="fig_rie9">
          <caption>Approximating <m>\int_{-1}^5 x^3\, dx</m> using the Right Hand Rule and 10 evenly spaced subintervals</caption>
          <!-- START figures/fig_rie9.tex -->
          <image xml:id="img_rie9" width="47%">
            <description></description>
            <latex-image>

            \begin{tikzpicture}

            \begin{axis}[
            axis on top,
            xtick={-1,1,2,3,4,5},
            ymin=-2,ymax=130,
            xmin=-1.5,xmax=5.5
            ]

            \addplot [firstcurvestyle,areastyle,domain=-1:5] {x^3} \closedcycle;
            \addplot [firstcurvestyle,-,domain=-1:5] {x^3};

            \foreach \x / \y in {-0.4 / -0.064, 0.2 / 0.008, 0.8 / 0.512, 1.4 / 2.744, 2. / 8., 2.6 /17.576, 3.2 / 32.768, 3.8 / 54.872, 4.4 / 85.184, 5. / 125.}
            {\addplot [thick,secondcolor] coordinates {(\x-.6,0) (\x-.6,\y) (\x,\y) (\x,0) (\x-.6,0)};
            }
            \end{axis}

            \end{tikzpicture}

            </latex-image>
          </image>
          <!-- figures/fig_rie9.tex END -->
        </figure>

        <p>
          Now find the exact answer using a limit:
          <me>
            \int_{-1}^5 x^3\, dx = \lim_{n\to\infty} \left(156 + \frac{378}n + \frac{216}{n^2}\right) = 156
          </me>.
        </p>
      </solution>
    </example>
  </subsection>

  <subsection>
    <title>Limits of Riemann Sums</title>
    <p>
      We have used limits to evaluate given definite integrals.
      Will this always work?
      It can be shown,
      given not-very-restrictive conditions,
      that yes, it will always work <mdash/> this is the content of
      <xref ref="thm_riemann_sum"/> below.
    </p>
<!--ToDo: add GeoGebra applet with adjustable number of rectangles to demonstrate limit process-->
    <p>
      The previous two examples demonstrated how an expression such as
      <me>
        \sum_{i=1}^n f(x_{i})\Delta x
      </me>
      can be rewritten as an expression explicitly involving <m>n</m>,
      such as <m>32/3(1-1/n^2)</m>.
    </p>

    <p>
      Viewed in this manner,
      we can think of the summation as a function of <m>n</m>.
      An <m>n</m> value is given
      (where <m>n</m> is a positive integer),
      and the sum of areas of <m>n</m> equally spaced rectangles is returned,
      using the Left Hand, Right Hand, or Midpoint Rules.
    </p>

    <p>
      Given a definite integral <m>\int_a^b f(x)\, dx</m>, let:
    </p>

    <p>
      <ul>
        <li>
          <p>
            <m>\ds S_L(n) = \sum_{i=1}^n f(x_{i-1})\Delta x</m>,
            the sum of equally spaced rectangles formed using the Left Hand Rule,
          </p>
        </li>

        <li>
          <p>
            <m>\ds S_R(n) = \sum_{i=1}^n f(x_{i})\Delta x</m>,
            the sum of equally spaced rectangles formed using the Right Hand Rule, and
          </p>
        </li>

        <li>
          <p>
            <m>\ds S_M(n) = \sum_{i=1}^n f\left(\frac{x_{i-1}+x_{i}}{2}\right)\Delta x</m>,
            the sum of equally spaced rectangles formed using the Midpoint Rule.
          </p>
        </li>
      </ul>
    </p>

    <p>
      Recall the definition of a limit as <m>n\to\infty</m>:
      <m>\lim\limits_{n\to\infty}S_L(n) = K</m> if, given any <m>\varepsilon \gt 0</m>,
      there exists <m>N \gt 0</m> such that
      <me>
        \abs{S_L(n)-K} \lt  \varepsilon  \text{ when }  n\geq N
      </me>.
    </p>

    <p>
      The following theorem states that we can use any of our three rules to find the exact value of a definite integral <m>\int_a^b f(x)\, dx</m>.
      It also goes two steps further.
      The theorem states that the height of each rectangle doesn't have to be determined following a specific rule,
      but could be <m>f(c_i)</m>,
      where <m>c_i</m> is any point in the <m>i</m>th subinterval,
      as discussed before Riemann Sums were defined in <xref ref="def_rie_sum">Definition</xref>.
    </p>

    <p>
      The theorem goes on to state that the rectangles do not need to be of the same width.
      Using the notation of <xref ref="def_partition">Definition</xref>,
      let <m>\Delta x_i</m> denote the length of the
      <m>i</m>th subinterval in a partition of <m>[a,b]</m> and let
      <m>\norm{\Delta x}</m> represent the length of the largest subinterval in the partition:
      that is, <m>\norm{\Delta x}</m> is the largest of all the <m>\Delta x_i</m>.
      If <m>\norm{\Delta x}</m> is small,
      then <m>[a,b]</m> must be partitioned into many subintervals,
      since all subintervals must have small lengths.
      <q>Taking the limit as <m>\norm{\Delta x}</m> goes to zero</q>
      implies that the number <m>n</m> of subintervals in the partition is growing to infinity,
      as the largest subinterval length is becoming arbitrarily small.
      We then interpret the expression
      <me>
        \lim_{\norm{\Delta x}\to 0}\sum_{i=1}^nf(c_i)\Delta x_i
      </me>
      as <q>the limit of the sum of the areas of rectangles,
      where the width of each rectangle can be different but getting small,
      and the height of each rectangle is not necessarily determined by a particular rule.</q>
      The theorem states that this Riemann Sum also gives the value of the definite integral of <m>f</m> over <m>[a,b]</m>.
    </p>

    <aside>
      <p>
        One of the things <xref ref="thm_riemann_sum"/>
        tells us is that if <m>f</m> is continuous on <m>[a,b]</m>,
        then the definite integral <m>\int_a^b f(x)\,dx</m>
        is guaranteed to exist.
      </p>

      <p>
        Knowing that every continuous function can be integrated is useful,
        since most of the functions we work with are continuous.
        However, it turns out that a function can be integrated even if it has a finite number of discontinuities,
        as long as these are removable or jump discontinuities.
      </p>
    </aside>

    <theorem xml:id="thm_riemann_sum">
      <title>Definite Integrals and the Limit of Riemann Sums</title>
      <statement>
        <p>
          Let <m>f</m> be continuous on the closed interval <m>[a,b]</m> and let <m>S_L(n)</m>,
          <m>S_R(n)</m>,
          <m>S_M(n)</m>, <m>\Delta x</m>,
          <m>\Delta x_i</m> and <m>c_i</m> be defined as before.
          Then:

          <idx><h>Riemann Sum</h><h>and definite integral</h></idx>

          <idx><h>integration</h><h>definite!Riemann Sums</h></idx>

        </p>

        <p>
          <ol>
            <li><m>\begin{aligned}\lim_{n\to\infty} S_L(n) \amp = \lim_{n\to\infty} S_R(n)\\
                    \amp = \lim_{n\to\infty} S_M(n)\\
                    \amp = \lim_{n\to\infty}\sum_{i=1}^n f(c_i)\Delta x\end{aligned}</m></li>

            <li><m>\ds \lim_{n\to\infty}\sum_{i=1}^n f(c_i)\Delta x = \int_a^b f(x)\, dx</m></li>

            <li><m>\lim_{\norm{\Delta x}\to 0} \sum_{i=1}^n f(c_i)\Delta x_i = \int_a^b f(x)\, dx</m></li>
          </ol>
        </p>
      </statement>
    </theorem>

    <figure xml:id="vid_int_rie_lim_rie_sum_def_int" component="video">
      <caption>Video presentation of <xref ref="thm_riemann_sum"/></caption>
      <video youtube="A-WLvclVMC0"/>
    </figure>


    <p>
      We summarize what we have learned over the past few sections here.
    </p>

    <p>
      <ul>
        <li>
          <p>
            Knowing the <q>area under the curve</q> can be useful.
            One common example: the area under a velocity curve is displacement.
          </p>
        </li>

        <li>
          <p>
            We have defined the definite integral, <m>\int_a^b f(x)\, dx</m>,
            to be the signed area under <m>f</m> on the interval <m>[a,b]</m>.
          </p>
        </li>

        <li>
          <p>
            While we can approximate a definite integral many ways,
            we have focused on using rectangles whose heights can be determined using the Left Hand Rule,
            the Right Hand Rule and the Midpoint Rule.
          </p>
        </li>

        <li>
          <p>
            Sums of rectangles of this type are called Riemann sums.
          </p>
        </li>

        <li>
          <p>
            The exact value of the definite integral can be computed using the limit of a Riemann sum.
            We generally use one of the above methods as it makes the algebra simpler.
          </p>
        </li>
      </ul>
    </p>

    <p>
      We first learned of derivatives through limits then learned rules that made the process simpler.
      We know of a way to evaluate a definite integral using limits;
      in the next section we will see how the Fundamental Theorem of Calculus makes the process simpler.
      The key feature of this theorem is its connection between the indefinite integral and the definite integral.
    </p>
  </subsection>

  <exercises>
    <subexercises>
      <title>Terms and Concepts</title>
      <exercise>
        <webwork>
          <pg-code>
            Context()->strings->add('limits'=>{});
            Context()->strings->add('limit'=>{alias=>'limits'});
          </pg-code>
          <statement>
            <p>
              A fundamental calculus technique is to use <var name="'limits'" width="10"/>
              to refine approximations to get an exact answer.
            </p>
          </statement>
        </webwork>
      </exercise>
      <!-- Exercise 2 -->
      <exercise>
        <webwork>
          <pg-code>
            $lb = random(2,9,1);
            $ub = random(12,20,1);
            $m = random(30,60,1);
            $b = non_zero_random(-300,300,1);
            if($envir{problemSeed}==1){$lb=7;$ub=14;$m=48;$b=-201;};
            Context()->variables->are(i=>'Real');
            $f = Formula("$m i + $b")->reduce;
          </pg-code>
          <statement>
            <p>
              What is the upper bound in the summation
              <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} (<var name="$f"/>)</m>?
            </p>
            <p>
              <var name="$ub" width="10"/>
            </p>
          </statement>
        </webwork>
      </exercise>
      <!-- Exercise 3 -->
      <exercise>
        <webwork>
          <pg-code>
            Context()->strings->add('rectangles'=>{});
            Context()->strings->add('rectangle'=>{alias=>'rectangles'});
          </pg-code>
          <statement>
            <p>
              This section approximates definite integrals using what geometric shape?
            </p>
            <p>
              <var name="'rectangles'" width="10"/>
            </p>
          </statement>
        </webwork>
      </exercise>
      <!-- Exercise 4 -->
      <exercise>
        <webwork>
          <pg-code>
            $true=PopUp(['?','True','False'],1);
            $false=PopUp(['?','True','False'],2);
          </pg-code>
          <statement>
            <p>
              <var name="$true" form="popup"/>
              A sum using the Right Hand Rule is an example of a Riemann Sum.
            </p>
          </statement>
        </webwork>
      </exercise>
    </subexercises>

    <subexercises>
      <title>Problems</title>
      <exercisegroup cols="2">
        <introduction>
          <p>
            Write out each term of the summation and compute the sum.
          </p>
        </introduction>
        <!-- Exercise 5 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = random(2,5,1);
              $ub = $lb + random(2,3,1);
              if($envir{problemSeed}==1){$lb=2;$ub=4;};
              @i = ($lb..$ub);
              @fi = map{$_**2}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} i^2</m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 6 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = random(-3,-1,1);
              $ub = random(1,3,1);
              $m = random(2,5,1);
              $b = non_zero_random(-3,3,1);
              if($envir{problemSeed}==1){$lb=-1;$ub=3;$m=4;$b=-2;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$m i + $b")->reduce;
              @i = ($lb..$ub);
              @fi = map{$m*$_ + $b}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)</m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 7 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = random(-3,-1,1);
              $ub = random(1,3,1);
              $trig = list_random('sin','cos');
              if($envir{problemSeed}==1){$lb=-2;$ub=2;$trig='sin';};
              Context()->variables->are(i=>'Real');
              $f = Formula("sin(pi i /2)")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 8 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = 1;
              ($ub,$c) = (5..10)[NchooseK(5,2)];
              if($envir{problemSeed}==1){$ub=10;$c=5;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$c")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 9 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = 1;
              $ub = random(4,6,1);
              if($envir{problemSeed}==1){$ub=5;};
              Context("Fraction");
              Context()->variables->are(i=>'Real');
              $f = Formula("1/i")->reduce;
              @i = ($lb..$ub);
              @fi = map{Fraction($f->eval(i=>$_))}(@i);
              $string = join('+',@fi);
              $sum = Fraction($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 10 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = 1;
              $ub = random(4,8,1);
              if($envir{problemSeed}==1){$ub=6;};
              Context()->variables->are(i=>'Real');
              $f = Formula("(-1)^i i")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 11 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = 1;
              $ub = random(3,5,1);
              if($envir{problemSeed}==1){$ub=4;};
              Context()->variables->are(i=>'Real');
              $f = Formula("1/i - 1/(i+1)")->reduce;
              @i = ($lb..$ub);
              Context("Fraction");
              @fi = map{Fraction($f->eval(i=>$_))}(@i);
              $string = join('+',@fi);
              $sum = Fraction($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)</m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 12 -->
        <exercise>
          <webwork>
            <pg-macros>
              <macro-file>contextForm.pl</macro-file>
            </pg-macros>
            <pg-code>
              $lb = random(0,1,1);
              $ub = random(4,6,1);
              if($envir{problemSeed}==1){$lb=0;$ub=5;};
              Context()->variables->are(i=>'Real');
              $f = Formula("(-1)^i cos(pi i)")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              Context("Form");
              Context()->operators->set(
                '+' => {class => 'bizarro::BOP::add', isCommand => 1},
                '-' => {class => 'bizarro::BOP::subtract', isCommand => 1},
              );
              $terms = Formula("$string");
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <instruction>
                Enter the sum of terms here. For example, <c>1+2+3</c>.
              </instruction>
              <p>
                <var name="$terms" width="20"/>
              </p>
              <instruction>
                Enter the actual sum here.
              </instruction>
              <p>
                <var name="$sum" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2">
        <introduction>
          <p>
            Write the sum in summation notation.
          </p>
        </introduction>
        <!-- Exercise 13 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(4,6,1);
              $m = random(2,9,1);
              if($envir{problemSeed}==1){$ub=5;$m=3;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$m i")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              Context()->flags->set(reduceConstants=>0);
              $terms = Formula("$string");
              $multians = MultiAnswer($lb, $ub, $f)->with(
                singleResult => 1,
                checker => sub {
                    my ( $correct, $student, $self ) = @_;
                    my ( $stulb, $stuub, $stuf ) = @{$student};
                    my ( $corlb, $corub, $corf ) = @{$correct};
                    if ($stuub - $stulb != $corub - $corlb) {Value::Error("Your sum does not have the correct number of terms");};
                    @stui = ($stulb..$stuub);
                    @stufi = map{$stuf->eval(i=>$_)}(@stui);
                    @cori = ($corlb..$corub);
                    @corfi = map{$corf->eval(i=>$_)}(@cori);
                    $score = 1;
                    for $j (0..$#corfi) {
                      if ($stufi[$j] != $corfi[$j]) {
                        $score = 0;
                        last;
                      }
                    }
                    return $score;
                  }
              );
            </pg-code>
            <statement>
              <p>
                <m><var name="$terms"/></m>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the start value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the end value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the summand expression here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              $lb = 0;
              $ub = random(5,9,1);
              $b = non_zero_random(-2,2,1);
              if($envir{problemSeed}==1){$ub=8;$b=-1;};
              Context()->variables->are(i=>'Real');
              $f = Formula("i^2 + $b")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              Context()->flags->set(reduceConstants=>0);
              $terms = Formula("$string");
              $multians = MultiAnswer($lb, $ub, $f)->with(
                singleResult => 1,
                checker => sub {
                    my ( $correct, $student, $self ) = @_;
                    my ( $stulb, $stuub, $stuf ) = @{$student};
                    my ( $corlb, $corub, $corf ) = @{$correct};
                    if ($stuub - $stulb != $corub - $corlb) {Value::Error("Your sum does not have the correct number of terms");};
                    @stui = ($stulb..$stuub);
                    @stufi = map{$stuf->eval(i=>$_)}(@stui);
                    @cori = ($corlb..$corub);
                    @corfi = map{$corf->eval(i=>$_)}(@cori);
                    $score = 1;
                    for $j (0..$#corfi) {
                      if ($stufi[$j] != $corfi[$j]) {
                        $score = 0;
                        last;
                      }
                    }
                    return $score;
                  }
              );
            </pg-code>
            <statement>
              <p>
                <m><var name="$terms"/></m>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the start value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the end value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the summand expression here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(4,6,1);
              $b = random(1,5,1);
              if($envir{problemSeed}==1){$ub=4;$b=1;};
              Context("Fraction");
              Context()->flags->set(reduceFractions=>0);
              Context()->variables->are(i=>'Real');
              $f = Formula("i/(i+$b)")->reduce;
              @i = ($lb..$ub);
              @fi = map{Fraction($_,$_+$b)}(@i);
              $string = join('+',@fi);
              Context()->flags->set(reduceConstants=>0);
              $terms = Formula("$string");
              $multians = MultiAnswer($lb, $ub, $f)->with(
                singleResult => 1,
                checker => sub {
                    my ( $correct, $student, $self ) = @_;
                    my ( $stulb, $stuub, $stuf ) = @{$student};
                    my ( $corlb, $corub, $corf ) = @{$correct};
                    if ($stuub - $stulb != $corub - $corlb) {Value::Error("Your sum does not have the correct number of terms");};
                    @stui = ($stulb..$stuub);
                    @stufi = map{$stuf->eval(i=>$_)}(@stui);
                    @cori = ($corlb..$corub);
                    @corfi = map{$corf->eval(i=>$_)}(@cori);
                    $score = 1;
                    for $j (0..$#corfi) {
                      if ($stufi[$j] != $corfi[$j]) {
                        $score = 0;
                        last;
                      }
                    }
                    return $score;
                  }
              );
            </pg-code>
            <statement>
              <p>
                <m><var name="$terms"/></m>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the start value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the end value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the summand expression here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              $lb = list_random(0,1);
              $ub = $lb + 4;
              if($envir{problemSeed}==1){$lb=0;};
              Context()->variables->are(i=>'Real');
              $f = ($lb == 0) ? Formula("(-1)^i") : Formula("(-1)^(i+1)");
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_) * Formula("e^$_")}(@i);
              $f = ($lb == 0) ? Formula("(-e)^i") : Formula("-(-e)^i");
              $string = join('+',@fi);
              Context()->flags->set(reduceConstants=>0);
              $terms = Formula("$string")->reduce;
              $multians = MultiAnswer($lb, $ub, $f)->with(
                singleResult => 1,
                checker => sub {
                    my ( $correct, $student, $self ) = @_;
                    my ( $stulb, $stuub, $stuf ) = @{$student};
                    my ( $corlb, $corub, $corf ) = @{$correct};
                    if ($stuub - $stulb != $corub - $corlb) {Value::Error("Your sum does not have the correct number of terms");};
                    @stui = ($stulb..$stuub);
                    @stufi = map{$stuf->eval(i=>$_)}(@stui);
                    @cori = ($corlb..$corub);
                    @corfi = map{$corf->eval(i=>$_)}(@cori);
                    $score = 1;
                    for $j (0..$#corfi) {
                      if ($stufi[$j] != $corfi[$j]) {
                        $score = 0;
                        last;
                      }
                    }
                    return $score;
                  }
              );
            </pg-code>
            <statement>
              <p>
                <m><var name="$terms"/></m>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the start value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the end value here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
              <instruction>
                If the sum were in sigma notation, <m>\sum\limits_{i=\text{start}}^{\text{end}}(\text{summand expression})</m>, enter the summand expression here.
              </instruction>
              <p>
                <var name="$multians" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2">
        <introduction>
          <p>
            Evaluate the summation using <xref ref="thm_summation">Theorem</xref>.
          </p>
        </introduction>

        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              ($ub,$c) = (5..10)[NchooseK(5,2)];
              if($envir{problemSeed}==1){$ub=10;$c=5;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$c")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 18 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(20,30,1);
              if($envir{problemSeed}==1){$ub=25;};
              Context()->variables->are(i=>'Real');
              $f = Formula("i")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 19 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(8,12,1);
              $a = random(2,6,1);
              $b = non_zero_random(-4,4,1);
              if($envir{problemSeed}==1){$ub=10;$a=3;$b=-2;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$a i^2 + $b i")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)</m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 20 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(12,20,1);
              $a = random(2,6,1);
              $b = non_zero_random(-10,10,1);
              if($envir{problemSeed}==1){$ub=15;$a=2;$b=-10;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$a i^3 + $b")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)</m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 21 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(8,12,1);
              ($a,$b,$c,$d) = (-12..-1,1..12)[NchooseK(24,4)];
              if($envir{problemSeed}==1){$ub=10;$a=-4;$b=10;$c=-7;$d=11;};
              Context()->variables->are(i=>'Real');
              Context()->noreduce('(-x)+y','(-x)-y');
              $f = Formula("$a i^3 + $b i^2 + $c i + $d")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)</m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 22 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(8,12,1);
              ($b,$c,$d) = (-9..-1,1..9)[NchooseK(18,3)];
              if($envir{problemSeed}==1){$ub=10;$b=-3;$c=2;$d=7;};
              Context()->variables->are(i=>'Real');
              Context()->noreduce('(-x)+y','(-x)-y');
              $f = Formula("i^3 + $b i^2 + $c i + $d")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)</m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 23 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(80,120,5);
              if($envir{problemSeed}==1){$ub=100;};
              Context()->variables->are(i=>'Real');
              $f = Formula("i")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              $penultimate = $ub - 1;
            </pg-code>
            <statement>
              <p>
                <m>1+2+3+\cdots+<var name="$penultimate"/>+<var name="$ub"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 24 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = 1;
              $ub = random(16,30,1);
              if($envir{problemSeed}==1){$ub=20;};
              Context()->variables->are(i=>'Real');
              $f = Formula("i^2")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
              $last = $ub**2;
              $penultimate = ($ub - 1)**2;
            </pg-code>
            <statement>
              <p>
                <m>1+4+9+\cdots+<var name="$penultimate"/>+<var name="$last"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2">
        <introduction>
          <p>
            <xref ref="thm_summation">Theorem</xref> states
            <m>\sum\limits_{i=1}^na_i = \sum\limits_{i=1}^k a_i + \sum\limits_{i=k+1}^n a_i</m>,
            so
            <m>\sum\limits_{i=k+1}^na_i = \sum\limits_{i=1}^n a_i - \sum\limits_{i=1}^k a_i</m>.
            Use this fact,
            along with other parts of <xref ref="thm_summation">Theorem</xref>,
            to evaluate the summation.
          </p>
        </introduction>
        <!-- Exercise 25 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = random(7,13,1);
              $ub = $lb + random(8,12,1);
              if($envir{problemSeed}==1){$lb=11;$ub=20;};
              Context()->variables->are(i=>'Real');
              $f = Formula("i")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 26 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = random(14,18,1);
              $ub = $lb + random(8,12,1);
              if($envir{problemSeed}==1){$lb=16;$ub=25;};
              Context()->variables->are(i=>'Real');
              $f = Formula("i**3")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 27 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = random(5,8,1);
              $ub = $lb + random(5,8,1);
              $c = random(3,8,1);
              if($envir{problemSeed}==1){$lb=7;$ub=12;$c=4;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$c")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 28 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = random(5,8,1);
              $ub = $lb + random(5,8,1);
              $c = random(3,8,1);
              if($envir{problemSeed}==1){$lb=5;$ub=10;$c=4;};
              Context()->variables->are(i=>'Real');
              $f = Formula("$c i**3")->reduce;
              @i = ($lb..$ub);
              @fi = map{$f->eval(i=>$_)}(@i);
              $string = join('+',@fi);
              $sum = Real($string);
            </pg-code>
            <statement>
              <p>
                <m>\sum\limits_{i=<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/></m>
              </p>
              <p>
                <var name="$sum" width="10"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2">
        <introduction>
          <p>
            In the following exercises, a definite integral <m>\ds \int_a^b f(x) \, dx</m> is given.
            <ol>
              <li>
                <p>
                  Graph <m>f(x)</m> on <m>[a,b]</m>.
                </p>
              </li>
              <li>
                <p>
                  Add to the sketch rectangles using the provided rule.
                </p>
              </li>
              <li>
                <p>
                  Approximate <m>\ds \int_a^b f(x) \, dx</m> by summing the areas of the rectangles.
                </p>
              </li>
            </ol>
          </p>
        </introduction>
        <!-- Exercise 29 -->
        <exercise>
          <statement>
            <p>
              <m>\ds \int_{-3}^3 x^2\, dx</m>,
              with <m>6</m> rectangles using the Left Hand Rule.
            </p>
          </statement>
        </exercise>
        <!-- Exercise 30 -->
        <exercise>
          <statement>
            <p>
              <m>\ds \int_{0}^2 (5-x^2)\, dx</m>,
              with <m>4</m> rectangles using the Midpoint Rule.
            </p>
          </statement>
        </exercise>
        <!-- Exercise 31 -->
        <exercise>
          <statement>
            <p>
              <m>\ds \int_{0}^\pi \sin(x) \, dx</m>,
              with <m>6</m> rectangles using the Right Hand Rule.
            </p>
          </statement>
        </exercise>
        <!-- Exercise 32 -->
        <exercise>
          <statement>
            <p>
              <m>\ds \int_{0}^3 2^x\, dx</m>,
              with <m>5</m> rectangles using the Left Hand Rule.
            </p>
          </statement>
        </exercise>
        <!-- Exercise 33 -->
        <exercise>
          <statement>
            <p>
              <m>\ds \int_{1}^2 \ln(x) \, dx</m>,
              with <m>3</m> rectangles using the Midpoint Rule.
            </p>
          </statement>
        </exercise>
        <!-- Exercise 34 -->
        <exercise>
          <statement>
            <p>
              <m>\ds \int_{1}^9 \frac1x\, dx</m>,
              with <m>4</m> rectangles using the Right Hand Rule.
            </p>
          </statement>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2">
        <introduction>
          <p>
            A definite integral is given below.
            As demonstrated in <xref ref="ex_rie9">Examples</xref>
            and <xref ref="ex_rie10"/>, do the following:
            <ol>
              <li>
                <p>
                  Find a formula to approximate the definite integral
                  using <m>n</m> subintervals and the provided rule.
                </p>
              </li>
              <li>
                <p>
                  Evaluate the formula using <m>n=10</m>,
                  <m>100</m>, and <m>1000</m>.
                </p>
              </li>
              <li>
                <p>
                  Find the limit of the formula, as <m>n\to \infty</m>,
                  to find the exact value of the definite integral.
                </p>
              </li>
            </ol>
          </p>
        </introduction>
        <!-- Exercise 35 -->
        <exercise>
          <webwork>
            <pg-code>
              $rule = list_random('Left Hand Rule','Right Hand Rule');
              if($envir{problemSeed}==1){$rule = 'Right Hand Rule';};
              Context()->variables->are(n=>"Real");
              if ($rule eq 'Left Hand Rule') {
                $sum = Formula("(n-1)^2/(4n^2)");
              }
              elsif ($rule eq 'Right Hand Rule') {
                $sum = Formula("(n+1)^2/(4n^2)");
              };
              $sum10 = $sum->eval(n=>10);
              $sum100 = $sum->eval(n=>100);
              $sum1000 = $sum->eval(n=>1000);
              Context("Fraction");
              $exact = Fraction(1,4);
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{0}^1 x^3\, dx</m>, using the <var name="$rule"/>.
              </p>
              <instruction>
                Enter the formula in terms of <m>n</m> here.
              </instruction>
              <p>
                <var name="$sum" width="30"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=10</m> here.
              </instruction>
              <p>
                <var name="$sum10" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=100</m> here.
              </instruction>
              <p>
                <var name="$sum100" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=1000</m> here.
              </instruction>
              <p>
                <var name="$sum1000" width="10"/>
              </p>
              <instruction>
                Enter the limit here.
              </instruction>
              <p>
                <var name="$exact" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 36 -->
        <exercise>
          <webwork>
            <pg-code>
              $rule = list_random('Left Hand Rule','Right Hand Rule');
              $lb = random(-2,-1,1);
              $ub = random(1,2,1);
              $c = random(2,5,1);
              if($envir{problemSeed}==1){$rule = 'Left Hand Rule';$lb=-1;$ub=1;$c=3;};
              Context("Fraction");
              Context()->variables->are(n=>"Real");
              $A = Fraction($c*($ub - $lb)*(6*$lb*$ub + 2*($ub - $lb)**2),6);
              $B = Fraction($c*($ub - $lb)*(6*$lb*($ub - $lb) + 3*($ub - $lb)**2),6);
              if ($rule eq 'Left Hand Rule') {$B = -$B;};
              $C = Fraction($c*($ub - $lb)**3,6);
              ($Bn,$Bd)=$B->value;
              ($Cn,$Cd)=$C->value;
              $sum = Formula("$A + $Bn/($Bd n) + $Cn/($Cd n^2)");
              $sum10 = $sum->eval(n=>10);
              $sum100 = $sum->eval(n=>100);
              $sum1000 = $sum->eval(n=>1000);
              $exact = $A;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$c"/>x^2\, dx</m>, using the <var name="$rule"/>.
              </p>
              <instruction>
                Enter the formula in terms of <m>n</m> here.
              </instruction>
              <p>
                <var name="$sum" width="30"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=10</m> here.
              </instruction>
              <p>
                <var name="$sum10" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=100</m> here.
              </instruction>
              <p>
                <var name="$sum100" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=1000</m> here.
              </instruction>
              <p>
                <var name="$sum1000" width="10"/>
              </p>
              <instruction>
                Enter the limit here.
              </instruction>
              <p>
                <var name="$exact" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 37 -->
        <exercise>
          <webwork>
            <pg-code>
              $lb = random(-2,-1,1);
              $ub = random(1,4,1);
              $m = random(2,5,1);
              $b = non_zero_random(-2,2,1);
              if($envir{problemSeed}==1){$lb=-1;$ub=3;$m=3;$b=-1;};
              $f = Formula("$m x + $b")->reduce;
              Context("Fraction");
              Context()->variables->are(n=>"Real");
              $sum = Fraction(($ub-$lb)*($m*($ub+$lb)+2*$b),2);
              $sum = Formula("$sum");
              $sum10 = $sum->eval(n=>10);
              $sum100 = $sum->eval(n=>100);
              $sum1000 = $sum->eval(n=>1000);
              $exact = Fraction("$sum");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)\, dx</m>, using the Midpoint Rule.
              </p>
              <instruction>
                Enter the formula in terms of <m>n</m> here.
              </instruction>
              <p>
                <var name="$sum" width="30"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=10</m> here.
              </instruction>
              <p>
                <var name="$sum10" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=100</m> here.
              </instruction>
              <p>
                <var name="$sum100" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=1000</m> here.
              </instruction>
              <p>
                <var name="$sum1000" width="10"/>
              </p>
              <instruction>
                Enter the limit here.
              </instruction>
              <p>
                <var name="$exact" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 38 -->
        <exercise>
          <webwork>
            <pg-code>
              $rule = list_random('Left Hand Rule','Right Hand Rule');
              $lb = random(1,2,1);
              $ub = $lb + random(2,4,1);
              $m = random(2,5,1);
              $b = non_zero_random(-4,4,1);
              if($envir{problemSeed}==1){$rule='Left Hand Rule';$lb=1;$ub=4;$m=2;$b=-3;};
              $f = Formula("$m x^2 + $b")->reduce;
              Context("Fraction");
              $A = Fraction(($ub - $lb)*($m*$ub**2 + $m*$ub*$lb + $m*$lb**2 + 3*$b),3);
              $B = Fraction($m*($ub - $lb)**2*($ub + $lb),2);
              if ($rule eq 'Left Hand Rule') {$B = -$B;};
              $C = Fraction($m*($ub - $lb)**3,6);
              ($Bn,$Bd)=$B->value;
              ($Cn,$Cd)=$C->value;
              Context()->variables->are(n=>"Real");
              $sum = Formula("$A + $Bn/($Bd n) + $Cn/($Cd n^2)");
              $sum10 = $sum->eval(n=>10);
              $sum100 = $sum->eval(n=>100);
              $sum1000 = $sum->eval(n=>1000);
              $exact = $A;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)\, dx</m>, using the <var name="$rule"/>.
              </p>
              <instruction>
                Enter the formula in terms of <m>n</m> here.
              </instruction>
              <p>
                <var name="$sum" width="30"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=10</m> here.
              </instruction>
              <p>
                <var name="$sum10" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=100</m> here.
              </instruction>
              <p>
                <var name="$sum100" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=1000</m> here.
              </instruction>
              <p>
                <var name="$sum1000" width="10"/>
              </p>
              <instruction>
                Enter the limit here.
              </instruction>
              <p>
                <var name="$exact" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 39 -->
        <exercise>
          <webwork>
            <pg-code>
              $rule = list_random('Left Hand Rule','Right Hand Rule');
              $lb = random(-12,-7,1);
              $ub = -$lb;
              $b = non_zero_random(3,8,1);
              if($envir{problemSeed}==1){$rule='Right Hand Rule';$lb=-10;$ub=10;$b=5;};
              $f = Formula("$b - x")->reduce;
              Context()->variables->are(n=>"Real");
              $sum = Formula("2*$ub*$b + (2*$ub**2)/n")->reduce;
              if ($rule eq 'Left Hand Rule') {
                $sum = Formula("2*$ub*$b - (2*$ub**2)/n")->reduce;
              };
              $sum10 = $sum->eval(n=>10);
              $sum100 = $sum->eval(n=>100);
              $sum1000 = $sum->eval(n=>1000);
              $exact = Real(2*$ub*$b);
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} \left(<var name="$f"/>\right)\, dx</m>, using the <var name="$rule"/>.
              </p>
              <instruction>
                Enter the formula in terms of <m>n</m> here.
              </instruction>
              <p>
                <var name="$sum" width="30"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=10</m> here.
              </instruction>
              <p>
                <var name="$sum10" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=100</m> here.
              </instruction>
              <p>
                <var name="$sum100" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=1000</m> here.
              </instruction>
              <p>
                <var name="$sum1000" width="10"/>
              </p>
              <instruction>
                Enter the limit here.
              </instruction>
              <p>
                <var name="$exact" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 40 -->
        <exercise>
          <webwork>
            <pg-code>
              $rule = list_random('Left Hand Rule','Right Hand Rule');
              if($envir{problemSeed}==1){$rule='Right Hand Rule';};
              $f = Formula("x^3 - x^2")->reduce;
              Context("Fraction");
              Context()->variables->are(n=>"Real");
              $sum = Formula("-1/12+1/(12n^2)");
              $sum10 = $sum->eval(n=>10);
              $sum100 = $sum->eval(n=>100);
              $sum1000 = $sum->eval(n=>1000);
              $exact = Fraction(-1,12);
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{0}^{1} \left(<var name="$f"/>\right)\, dx</m>, using the <var name="$rule"/>.
              </p>
              <instruction>
                Enter the formula in terms of <m>n</m> here.
              </instruction>
              <p>
                <var name="$sum" width="30"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=10</m> here.
              </instruction>
              <p>
                <var name="$sum10" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=100</m> here.
              </instruction>
              <p>
                <var name="$sum100" width="10"/>
              </p>
              <instruction>
                Evaluate the formula using <m>n=1000</m> here.
              </instruction>
              <p>
                <var name="$sum1000" width="10"/>
              </p>
              <instruction>
                Enter the limit here.
              </instruction>
              <p>
                <var name="$exact" width="20"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>
    </subexercises>

    <subexercises>
      <title>Review</title>
      <exercisegroup cols="2">
        <introduction>
          <p>
            Find the general antiderivative of the given function.
          </p>
        </introduction>
        <!-- Exercise 41 -->
        <exercise>
          <webwork>
            <pg-code>
              $trig = list_random('tan','sec','csc','cot');
              $c = random(2,9,1);
              if($envir{problemSeed}==1){$trig='tan';$c=5;};
              $F = Formula("$c*$trig(x)");
              $f = $F->D('x')->reduce;
              $F = FormulaUpToConstant("$c*$trig(x)");
            </pg-code>
            <statement>
              <p>
                <m>f(x) = <var name="$f"/></m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              $c = random(2,9,1);
              if($envir{problemSeed}==1){$c=7;};
              $f = Formula("$c/x");
              $F = FormulaUpToConstant("$c*ln(abs(x))");
            </pg-code>
            <statement>
              <p>
                <m>f(x) = <var name="$f"/></m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              ($a,$b,$c) = (-9..-1,1..9)[NchooseK(18,3)];
              ($m,$n,$p) = num_sort((0..5)[NchooseK(6,3)]);
              if($envir{problemSeed}==1){$a=4;$b=-5;$c=8;$m=5;$n=3;$p=0;};
              Context()->variables->add(t=>"Real");
              $f = Formula("$a t^$m + $b t^$n + $c t^$p")->reduce;
              Context("Fraction");
              Context()->variables->add(t=>"Real");
              $A = Fraction($a,$m+1);
              $B = Fraction($b,$n+1);
              $C = Fraction($c,$p+1);
              $F = FormulaUpToConstant("$A t^($m+1) + $B t^($n+1) + $C t^($p+1)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>g(t) = <var name="$f"/></m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              ($b,$c) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$b=8;$c=5;};
              Context()->variables->add(t=>"Real");
              $f = Formula("$c $b^t")->reduce;
              Context()->flags->set(reduceConstantFunctions=>0);
              $F = FormulaUpToConstant("$c/ln($b) $b^t");
            </pg-code>
            <statement>
              <p>
                <m>g(t) = <var name="$f"/></m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              Context()->variables->add(t=>"Real");
              $F = FormulaUpToConstant("sin(t)-cos(t)");
            </pg-code>
            <statement>
              <p>
                <m>g(t) = \cos(t) + \sin(t)</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise>
          <webwork>
            <pg-code>
              $F = FormulaUpToConstant("2*sqrt(x)");
            </pg-code>
            <statement>
              <p>
                <m>f(x) = \frac{1}{\sqrt{x}}</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>
    </subexercises>
  </exercises>
</section>
