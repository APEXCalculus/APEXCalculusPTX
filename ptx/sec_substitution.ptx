<?xml version="1.0" encoding="UTF-8"?>
<section xml:id="sec_substitution">
  <title>Substitution</title>
  <introduction>

    <figure xml:id="vid_int_sub_intro" component="video">
      <caption>Video introduction to <xref ref="sec_substitution"/></caption>
      <video youtube="mElhuqXsPhQ" label="vid_int_sub_intro"/>
    </figure>

    <p>
      We motivate this section with an example.
      Let <m>f(x) = (x^2+3x-5)^{10}</m>.
      We can compute <m>\fp(x)</m> using the Chain Rule.
      It is:
      <md>
        <mrow>\fp(x) \amp = 10(x^2+3x-5)^9\cdot(2x+3)</mrow>
        <mrow>\amp = (20x+30)(x^2+3x-5)^9</mrow>
      </md>.
    </p>

    <p>
      Now consider this: What is <m>\int (20x+30)(x^2+3x-5)^9\, dx</m>?
      We have the answer in front of us;
      <me>
        \int (20x+30)(x^2+3x-5)^9\, dx = (x^2+3x-5)^{10}+C
      </me>.
    </p>

    <p>
      How would we have evaluated this indefinite integral without starting with <m>f(x)</m> as we did?
    </p>

    <p>
      This section explores <em>integration by substitution.</em>
      It allows us to <q>undo the Chain Rule.</q>
      Substitution allows us to evaluate the above integral without knowing the original function first.
    </p>

    <p>
      The underlying principle is to rewrite a <q>complicated</q>
      integral of the form <m>\int f(x)\, dx</m> as a not-so-complicated integral <m>\int h(u)\, du</m>.
      We'll formally establish later how this is done.
      First, consider again our introductory indefinite integral,
      <m>\int (20x+30)(x^2+3x-5)^9\, dx</m>.
      Arguably the most <q>complicated</q>
      part of the integrand is <m>(x^2+3x-5)^9</m>.
      We wish to make this simpler;
      we do so through a substitution.
      Let <m>u=x^2+3x-5</m>.
      Thus
      <me>
        (x^2+3x-5)^9 = u^9
      </me>.
    </p>

    <p>
      We have established <m>u</m> as a function of <m>x</m>,
      so now consider the differential of <m>u</m>:
      <me>
        du = (2x+3)dx
      </me>.
    </p>

    <p>
      Keep in mind that <m>(2x+3)</m> and <m>dx</m> are multiplied;
      the <m>dx</m> is not <q>just sitting there.</q>
    </p>

    <p>
      Return to the original integral and do some substitutions through algebra:
      <md>
        <mrow>\int (20x+30)(x^2+3x-5)^9\, dx 	\amp =	\int 10(2x+3)(x^2+3x-5)^9\, dx</mrow>
        <mrow>\amp =\int 10(\underbrace{x^2+3x-5}_u)^9\underbrace{(2x+3)\, dx}_{du}</mrow>
        <mrow>\amp =\int 10u^9\, du</mrow>
        <mrow>\amp = u^{10} + C  \quad \text{(replace \(u\) with \(x^2+3x-5\)) }</mrow>
        <mrow>\amp = (x^2+3x-5)^{10} +C</mrow>
      </md>
    </p>

    <p>
      One might well look at this and think <q>I
      (sort of)
      followed how that worked,
      but I could never come up with that on my own,</q>
      but the process is learnable.
      This section contains numerous examples through which the reader will gain understanding and mathematical maturity enabling them to regard substitution as a natural tool when evaluating integrals.
    </p>

    <p>
      We stated before that integration by substitution
      <q>undoes</q> the Chain Rule.
      Specifically,
      let <m>F(x)</m> and <m>g(x)</m> be differentiable functions and consider the derivative of their composition:
      <me>
        \frac{d}{dx}\Big(F\big(g(x)\big)\Big) = \Fp(g(x))g'(x)
      </me>.
    </p>

    <p>
      Thus
      <me>
        \int \Fp(g(x))g'(x)\, dx = F(g(x)) + C
      </me>.
    </p>

    <p>
      Integration by substitution works by recognizing the <q>inside</q>
      function <m>g(x)</m> and replacing it with a variable.
      By setting <m>u=g(x)</m>, we can rewrite the derivative as
      <me>
        \frac{d}{dx}\Big(F\big(u\big)\Big) = \Fp(u)u'
      </me>.
    </p>

    <p>
      Since <m>du = g'(x)dx</m>, we can rewrite the above integral as
      <me>
        \int \Fp(g(x))g'(x)\, dx = \int \Fp(u) du = F(u)+C = F(g(x))+ C
      </me>.
    </p>

    <p>
      This concept is important so we restate it in the context of a theorem.
    </p>

    <theorem xml:id="thm_subst">
      <title>Integration by Substitution</title>
      <statement>
        <p>
          Let <m>F</m> and <m>g</m> be differentiable functions,
          where the range of <m>g</m> is an interval <m>I</m> contained in the domain of <m>F</m>.
          Then <idx><h>integration</h><h>by substitution</h></idx>
          <me>
            \int \Fp(g(x))g'(x)\, dx = F(g(x)) + C
          </me>.
        </p>

        <p>
          If <m>u = g(x)</m>, then <m>du = g'(x)dx</m> and
          <me>
            \int \Fp(g(x))g'(x)\, dx = \int \Fp(u)\, du = F(u)+C = F(g(x))+C
          </me>.
        </p>
      </statement>
    </theorem>

    <p>
      The point of substitution is to make the integration step easy.
      Indeed, the step <m>\int \Fp(u)\, du = F(u) + C</m> looks easy,
      as the antiderivative of the derivative of <m>F</m> is just <m>F</m>,
      plus a constant.
      The <q>work</q> involved is making the proper substitution.
      There is not a step-by-step process that one can memorize;
      rather, experience will be one's guide.
      To gain experience, we now embark on many examples.
    </p>

    <example xml:id="ex_sub1">
      <title>Integrating by substitution</title>
      <statement>
        <p>
          Evaluate <m>\ds \int x\sin(x^2+5)\, dx</m>.
        </p>
      </statement>
      <solution>
        <p>
          Knowing that substitution is related to the Chain Rule,
          we choose to let <m>u</m> be the <q>inside</q>
          function of <m>\sin(x^2+5)</m>.
          (This is not <em>always</em> a good choice,
          but it is often the best place to start.)
        </p>

        <p>
          Let <m>u = x^2+5</m>, hence <m>du = 2x\,dx</m>.
          The integrand has an <m>x\,dx</m> term,
          but not a <m>2x\,dx</m> term.
          (Recall that multiplication is commutative,
          so the <m>x</m> does not physically have to be next to <m>dx</m> for there to be an <m>x\,dx</m> term.)
          We can divide both sides of the <m>du</m> expression by 2:
          <me>
            du = 2x\,dx \quad \Rightarrow \quad  \frac12du = x\,dx
          </me>.
        </p>

        <p>
          We can now substitute.
          <md>
            <mrow>\int x\sin(x^2+5)\, dx \amp = \int \sin(\underbrace{x^2+5}_u) \underbrace{x\, dx}_{\frac12du}</mrow>
            <mrow>\amp = \int \frac12\sin(u) \, du</mrow>
            <mrow>\amp = -\frac12\cos(u) + C \quad \text{ (now replace \(u\) with \(x^2+5\)) }</mrow>
            <mrow>\amp =-\frac12\cos(x^2+5) + C</mrow>
          </md>.
        </p>

        <p>
          Thus <m>\int x\sin(x^2+5)\, dx = -\frac12\cos(x^2+5)+C</m>.
          We can check our work by evaluating the derivative of the right hand side.
        </p>
      </solution>
    </example>

    <example xml:id="ex_sub2">
      <title>Integrating by substitution</title>
      <statement>
        <p>
          Evaluate <m>\ds \int \cos(5x)\, dx</m>.
        </p>
      </statement>
      <solution>
        <p>
          Again let <m>u</m> replace the <q>inside</q> function.
          Letting <m>u = 5x</m>, we have <m>du = 5\, dx</m>.
          Since our integrand does not have a <m>5\, dx</m> term,
          we can divide the previous equation by <m>5</m> to obtain <m>\frac15du = dx</m>.
          We can now substitute.
          <md>
            <mrow>\int \cos(5x)\, dx \amp = \int \cos(\underbrace{5x}_u) \underbrace{dx}_{\frac15du}</mrow>
            <mrow>\amp =	\int \frac15\cos(u) \, du</mrow>
            <mrow>\amp = \frac15\sin(u) + C</mrow>
            <mrow>\amp = \frac15\sin(5x)+C</mrow>
          </md>.
        </p>

        <p>
          We can again check our work through differentiation.
        </p>
      </solution>
    </example>

    <p>
      The previous example exhibited a common,
      and simple, type of substitution.
      The <q>inside</q> function was a linear function
      (in this case, <m>y = 5x</m>).
      When the inside function is linear,
      the resulting integration is very predictable, outlined here.
    </p>

    <insight xml:id="idea_linearsub">
      <title>Substitution With A Linear Function</title>
      <p>
        Consider <m>\int \Fp(ax+b)\, dx</m>,
        where <m>a\neq 0</m> and <m>b</m> are constants.
        Letting <m>u = ax+b</m> gives
        <m>du = a\cdot dx</m>, leading to the result
        <me>
          \int \Fp(ax+b)\, dx = \frac{1}{a}F(ax+b) + C
        </me>.
      </p>
    </insight>

    <p>
      Thus <m>\int \sin(7x-4)\, dx = -\frac17\cos(7x-4)+C</m>.
      Our next example can use <xref ref="idea_linearsub">Key Idea</xref>,
      but we will only employ it after going through all of the steps.
    </p>

    <example xml:id="ex_sub3">
      <title>Integrating by substituting a linear function</title>
      <statement>
        <p>
          Evaluate <m>\ds \int \frac{7}{-3x+1}\, dx</m>.
        </p>
      </statement>
      <solution>
        <p>
          View the integrand as the composition of functions <m>f(g(x))</m>,
          where <m>f(x) = 7/x</m> and <m>g(x) = -3x+1</m>.
          Employing our understanding of substitution,
          we let <m>u = -3x+1</m>, the inside function.
          Thus <m>du = -3\, dx</m>.
          The integrand lacks a <m>-3</m>;
          hence divide the previous equation by <m>-3</m> to obtain <m>-du/3 = dx</m>.
          We can now evaluate the integral through substitution.
          <md>
            <mrow>\int \frac{7}{-3x+1}\, dx \amp =  \int \frac{7}{u}\frac{du}{-3}</mrow>
            <mrow>\amp = \frac{-7}3\int \frac{du}{u}</mrow>
            <mrow>\amp =	\frac{-7}3\ln\abs{u} + C</mrow>
            <mrow>\amp =-\frac73\ln\abs{-3x+1} + C</mrow>
          </md>.
        </p>

        <p>
          Using <xref ref="idea_linearsub">Key Idea</xref> is faster,
          recognizing that <m>u</m> is linear and <m>a = -3</m>.
          One may want to continue writing out all the steps until they are comfortable with this particular shortcut.
        </p>
      </solution>
    </example>

    <figure xml:id="vid_int_sub_examples_1" component="video">
      <caption>Video presentation of <xref first="ex_sub1" last="ex_sub3">Examples</xref></caption>
      <video youtube="-6CFSvtMCDU" label="vid_int_sub_examples_1"/>
    </figure>


    <p>
      Not all integrals that benefit from substitution have a clear
      <q>inside</q> function.
      Several of the following examples will demonstrate ways in which this occurs.
    </p>

    <example xml:id="ex_sub10">
      <title>Integrating by substitution</title>
      <statement>
        <p>
          Evaluate <m>\ds \int \sin(x) \cos(x) \, dx</m>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="UdGVU8H5w3M" xml:id="vid_int_sub_ex_1" label="vid_int_sub_ex_1" component="video"/>
      </solution>
      <solution>

        <p>
          There is not a composition of functions here to exploit;
          rather, just a product of functions.
          Do not be afraid to experiment;
          when given an integral to evaluate,
          it is often beneficial to think
          <q>If I let <m>u</m> be <em>this</em>,
          then <m>du</m> must be <em>that</em> <ellipsis/></q>
          and see if this helps simplify the integral at all.
        </p>

        <p>
          In this example, let's set <m>u = \sin(x)</m>.
          Then <m>du = \cos(x) \, dx</m>,
          which we have as part of the integrand!
          The substitution becomes very straightforward:
          <md>
            <mrow>\int \sin(x) \cos(x) \, dx \amp =	\int u\, du</mrow>
            <mrow>\amp = \frac12u^2+ C</mrow>
            <mrow>\amp = \frac12\sin^2(x) + C</mrow>
          </md>.
        </p>

        <p>
          One would do well to ask <q>What would happen if we let <m>u = \cos(x)</m>?</q>
          The result is just as easy to find, yet looks very different.
          The challenge to the reader is to evaluate the integral letting
          <m>u = \cos(x)</m> and discover why the answer is the same,
          yet looks different.
        </p>
      </solution>
    </example>

    <p>
      Our examples so far have required
      <q>basic substitution.</q>
      The next example demonstrates how substitutions can be made that often strike the new learner as being <q>nonstandard.</q>
    </p>

    <example xml:id="ex_sub4">
      <title>Integrating by substitution</title>
      <statement>
        <p>
          Evaluate <m>\ds\int x\sqrt{x+3}\, dx</m>.
        </p>
      </statement>
      <solution>
        <p>
          Recognizing the composition of functions, set <m>u = x+3</m>.
          Then <m>du = dx</m>,
          giving what seems initially to be a simple substitution.
          But at this stage, we have:
          <me>
            \int x\sqrt{x+3}\, dx = \int x\sqrt{u}\, du
          </me>.
        </p>

        <p>
          We cannot evaluate an integral that has both an <m>x</m> and an <m>u</m> in it.
          We need to convert the <m>x</m> to an expression involving just <m>u</m>.
        </p>

        <p>
          Since we set <m>u = x+3</m>, we can also state that <m>u-3 = x</m>.
          Thus we can replace <m>x</m> in the integrand with <m>u-3</m>.
          It will also be helpful to rewrite <m>\sqrt{u}</m> as <m>u^\frac12</m>.
          <md>
            <mrow>\int x\sqrt{x+3} \, dx \amp = \int (u-3)u^\frac12\, du</mrow>
            <mrow>\amp = \int \big(u^\frac32 - 3u^\frac12\big) \, du</mrow>
            <mrow>\amp = \frac25u^\frac52 - 2u^\frac32 + C</mrow>
            <mrow>\amp = \frac25(x+3)^\frac52 - 2(x+3)^\frac32 + C</mrow>
          </md>.
        </p>

        <p>
          Checking your work is always a good idea.
          In this particular case,
          some algebra will be needed to make one's answer match the integrand in the original problem.
        </p>
      </solution>
    </example>

    <example xml:id="ex_sub5">
      <title>Integrating by substitution</title>
      <statement>
        <p>
          Evaluate <m>\ds \int \frac{1}{x\ln(x) }\, dx</m>.
        </p>
      </statement>
      <solution>
        <p>
          This is another example where there does not seem to be an obvious composition of functions.
          The line of thinking used in <xref ref="ex_sub4">Example</xref> is useful here:
          choose something for <m>u</m> and consider what this implies <m>du</m> must be.
          If <m>u</m> can be chosen such that <m>du</m> also appears in the integrand,
          then we have chosen well.
        </p>

        <p>
          Choosing <m>u = 1/x</m> makes <m>du = -1/x^2\, dx</m>;
          that does not seem helpful.
          However, setting <m>u = \ln(x)</m> makes <m>du = 1/x\, dx</m>,
          which is part of the integrand.
          Thus:
          <md>
            <mrow>\int \frac1{x\ln(x)}\, dx   \amp =  \int \frac{1}{\underbrace{\ln(x)}_{u}}\underbrace{\frac1x\, dx}_{du}</mrow>
            <mrow>\amp = \int \frac1u\, du</mrow>
            <mrow>\amp = \ln\abs{u} + C</mrow>
            <mrow>\amp = \ln\abs{ \ln(x) } + C</mrow>
          </md>.
        </p>

        <p>
          The final answer is interesting;
          the natural log of the natural log.
          Take the derivative to confirm this answer is indeed correct.
        </p>
      </solution>
    </example>

    <figure xml:id="vid_int_sub_examples_2" component="video">
      <caption>Video presentation of <xref first="ex_sub4" last="ex_sub5">Examples</xref></caption>
      <video youtube="Qzj4UJX_69c" label="vid_int_sub_examples_2"/>
    </figure>

  </introduction>

  <subsection>
    <title>Integrals Involving Trigonometric Functions</title>
    <p>
      <xref ref="sec_trigint">Section</xref>
      delves deeper into integrals of a variety of trigonometric functions;
      here we use substitution to establish a foundation that we will build upon.
    </p>

    <p>
      The next three examples will help fill in some missing pieces of our antiderivative knowledge.
      We know the antiderivatives of the sine and cosine functions;
      what about the other standard functions tangent,
      cotangent, secant and cosecant?
      We discover these next.
    </p>

    <example xml:id="ex_sub6">
      <title>Integrating by substitution: the antiderivative of <m>\tan(x)</m></title>
      <statement>
        <p>
          Evaluate <m>\int \tan(x) \, dx</m>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="sJryXwwdqM4" xml:id="vid-int-sub-ex-tan" label="vid-int-sub-ex-tan" component="video"/>
      </solution>
      <solution>

        <p>
          The previous paragraph established that we did not know the antiderivatives of tangent,
          hence we must assume that we have learned something in this section that can help us evaluate this indefinite integral.
        </p>

        <p>
          Rewrite <m>\tan(x)</m> as <m>\sin(x) /\cos(x)</m>.
          While the presence of a composition of functions may not be immediately obvious,
          recognize that <m>\cos(x)</m> is
          <q>inside</q> the <m>1/x</m> function.
          Therefore, we see if setting
          <m>u = \cos(x)</m> returns usable results.
          We have that <m>du = -\sin(x) \, dx</m>,
          hence <m>-du = \sin(x) \, dx</m>.
          We can integrate:
          <md>
            <mrow>\int \tan(x) \, dx \amp = \int \frac{\sin(x) }{\cos(x) }\, dx</mrow>
            <mrow>\amp = \int \frac1{\underbrace{\cos(x) }_u}\underbrace{\sin(x) \, dx}_{-du}</mrow>
            <mrow>\amp = \int \frac {-1}u \, du</mrow>
            <mrow>\amp = -\ln\abs{u} + C</mrow>
            <mrow>\amp = -\ln\abs{\cos(x) } + C</mrow>
          </md>.
        </p>

        <p>
          Some texts prefer to bring the <m>-1</m> inside the logarithm as a power of <m>\cos(x)</m>, as in:
          <md>
            <mrow>-\ln\abs{\cos(x) } + C \amp = \ln\abs{(\cos(x) )^{-1}} + C</mrow>
            <mrow>\amp = \ln\abs{ \frac{1}{\cos(x) }} + C</mrow>
            <mrow>\amp = \ln\abs{\sec(x) } + C</mrow>
          </md>.
        </p>

        <p>
          Thus the result they give is <m>\int \tan(x) \, dx = \ln\abs{\sec(x) } + C</m>.
          These two answers are equivalent.
        </p>
      </solution>
    </example>

    <example xml:id="ex_sub7">
      <title>Integrating by substitution: the antiderivative of <m>\sec(x)</m></title>
      <statement>
        <p>
          Evaluate <m>\int \sec(x) \, dx</m>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="ivQ5GFSvEGg" xml:id="vid-int-sub-ex-sec" label="vid-int-sub-ex-sec" component="video"/>
      </solution>
      <solution>
        <p>
          This example employs a wonderful trick:
          multiply the integrand by <q>1</q>
          so that we see how to integrate more clearly.
          In this case, we write <q>1</q> as
          <me>
            1 = \frac{\sec(x) + \tan(x) }{\sec(x) + \tan(x) }
          </me>.
        </p>

        <p>
          This may seem like it came out of left field, but it works beautifully.
          Consider:
          <md>
            <mrow>\int \sec(x) \, dx	\amp =	\int \sec(x) \cdot \frac{\sec(x) + \tan(x) }{\sec(x) + \tan(x) }\, dx</mrow>
            <mrow>\amp = \int \frac{\sec^2(x) + \sec(x) \tan(x) }{\sec(x) + \tan(x) }\, dx.</mrow>
            <intertext>Now let <m>u = \sec(x) +\tan(x)</m>; this means <m>du = (\sec(x) \tan(x) + \sec^2(x) )\, dx</m>, which is our numerator. Thus:</intertext>
            <mrow>\amp = \int \frac{du}{u}</mrow>
            <mrow>\amp = \ln\abs{u} + C</mrow>
            <mrow>\amp = \ln\abs{\sec(x) +\tan(x) } + C</mrow>
          </md>.
        </p>
      </solution>
    </example>

    <!-- <figure xml:id="vid_int_sub_trig_ex" component="video">
      <caption>Video presentation of <xref first="ex_sub6" last="ex_sub7">Examples</xref></caption>
      <video youtube="OX7WRbWGrts" label="vid_int_sub_trig_ex"/>
    </figure> -->


    <p>
      We can use similar techniques to those used in <xref ref="ex_sub6">Examples</xref>
      and <xref ref="ex_sub7"/>
      to find antiderivatives of <m>\cot(x)</m> and <m>\csc(x)</m>
      (which the reader can explore in the exercises.)
      We summarize our results here.
    </p>

    <theorem xml:id="thm_triganti">
      <title>Antiderivatives of Trigonometric Functions</title>
      <statement>

        <p>
          <idx><h>integration</h><h>of trig. functions</h></idx>
        </p>

        <!--TODO: Fix the column spacing. I don't know how to do it. -->
        <!--Changed to one column. Not enough room for two.-->

        <p>
          <ol>
            <li><m>\int \sin(x) \, dx = -\cos(x) +C</m>,</li>

            <li><m>\int \cos(x) \, dx = \sin(x) + C</m>,</li>

            <li><m>\int \tan(x) \, dx = -\ln\abs{\cos(x) }+C</m>,</li>

            <li><m>\int \csc(x) \, dx = -\ln\abs{\csc(x) +\cot(x) } +C</m>,</li>

            <li><m>\int \sec(x) \, dx = \ln\abs{\sec(x) +\tan(x) } + C</m>,</li>

            <li><m>\int \cot(x) \, dx = \ln\abs{\sin(x) }+C</m>,</li>
          </ol>
        </p>
      </statement>
    </theorem>

    <p>
      We explore one more common trigonometric integral.
    </p>

    <example xml:id="ex_sub8">
      <title>Integration by substitution: powers of <m>\cos(x)</m> and <m>\sin(x)</m></title>
      <statement>
        <p>
          Evaluate <m>\int \cos^2(x) \, dx</m>.
        </p>
      </statement>
      <solution>
        <p>
          We have a composition of functions as <m>\cos^2(x) = \big(\cos(x) \big)^2</m>.
          However, setting <m>u = \cos(x)</m> means <m>du = -\sin(x) \, dx</m>,
          which we do not have in the integral.
          Another technique is needed.
        </p>

        <aside>
          <p>
            The power reduction identities can be found in
            <xref ref="reference-trig-power-reduction">List</xref>
            in <xref ref="appendix-reference"/>.
          </p>
        </aside>

        <p>
          The process we'll employ is to use a Power Reducing formula for <m>\cos^2(x)</m>,
          which states
          <me>
            \cos^2(x) = \frac{1+\cos(2x)}{2}
          </me>.
        </p>

        <p>
          The right hand side of this equation is not difficult to integrate.
          We have:
          <md>
            <mrow>\int \cos^2(x) \, dx \amp = \int \frac{1+\cos(2x)}2\, dx</mrow>
            <mrow>\amp =	\int \left( \frac12 + \frac12\cos(2x)\right)\, dx</mrow>
            <mrow>\amp = \frac12x + \frac12\frac{\sin(2x)}{2} + C</mrow>
            <mrow>\amp = \frac12x + \frac{\sin(2x)}4 + C</mrow>
          </md>,
          where we used <xref ref="idea_linearsub">Key Idea</xref> for the antiderivative of <m>\cos(2x)</m>.
        </p>

        <p>
          We'll make significant use of this power-reducing technique in future sections.
        </p>
      </solution>
    </example>

    <figure xml:id="vid-int-sub-ex-trig" component="video">
      <caption>Video presentation of <xref ref="ex_sub8"/> and two other trigonometric examples</caption>
      <video youtube="XB_PG1Z_n1M" label="vid-int-sub-ex-trig"/>
    </figure>
  </subsection>

  <subsection>
    <title>Simplifying the Integrand</title>
    <p>
      It is common to be reluctant to manipulate the integrand of an integral;
      at first, our grasp of integration is tenuous and one may think that working with the integrand will improperly change the results.
      Integration by substitution works using a different logic:
      as long as <em>equality</em> is maintained,
      the integrand can be manipulated so that its
      <em>form</em> is easier to deal with.
      The next two examples demonstrate common ways in which using algebra first makes the integration easier to perform.
    </p>

    <example xml:id="ex_sub9">
      <title>Integration by substitution: simplifying first</title>
      <statement>
        <p>
          Evaluate <m>\ds\int \frac{x^3+4x^2+8x+5}{x^2+2x+1}\, dx</m>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="kuHKfsyaOAI" xml:id="vid-int-sub-with-longdiv" label="vid-int-sub-with-longdiv" component="video"/>
      </solution>
      <solution>
        <p>
          One may try to start by setting <m>u</m> equal to either the numerator or denominator;
          in each instance, the result is not workable.
        </p>

        <p>
          When dealing with rational functions (<ie/>, quotients made up of polynomial functions),
          it is an almost universal rule that everything works better when the degree of the numerator is less than the degree of the denominator.
          Hence we use polynomial division.
        </p>

        <p>
          We skip the specifics of the steps,
          but note that when <m>x^2+2x+1</m> is divided into <m>x^3+4x^2+8x+5</m>,
          it goes in <m>x+2</m> times with a remainder of <m>3x+3</m>.
          Thus
          <me>
            \frac{x^3+4x^2+8x+5}{x^2+2x+1} = x+2 + \frac{3x+3}{x^2+2x+1}
          </me>.
        </p>
        <!--TODO: aside with link to long division reference-->
        <p>
          Integrating <m>x+2</m> is simple.
          The fraction can be integrated by setting <m>u = x^2+2x+1</m>,
          giving <m>du = (2x+2)\, dx</m>.
          This is very similar to the numerator.
          Note that <m>du/2 = (x+1)\, dx</m> and then consider the following:
          <md>
            <mrow>\int \frac{x^3+4x^2+8x+5}{x^2+2x+1}\, dx \amp  = \int \left(x+2 + \frac{3x+3}{x^2+2x+1}\right)\, dx</mrow>
            <mrow>\amp = \int (x+2)\, dx + \int \frac{3(x+1)}{x^2+2x+1}\, dx</mrow>
            <mrow>\amp  = \frac12x^2+2x+C_1 + \int \frac{3}{u}\frac{du}{2}</mrow>
            <mrow>\amp = \frac12x^2+2x+C_1 + \frac32\ln\abs{u} + C_2</mrow>
            <mrow>\amp = \frac12x^2+2x+\frac32\ln\abs{x^2+2x+1} + C</mrow>
          </md>.
        </p>

        <p>
          In some ways, we <q>lucked out</q> in that after dividing,
          substitution was able to be done.
          In later sections we'll develop techniques for handling rational functions where substitution is not directly feasible.
        </p>
      </solution>
    </example>

    <example xml:id="ex_sub11">
      <title>Integration by alternate methods</title>
      <statement>
        <p>
          Evaluate <m>\ds\int \frac{x^2+2x+3}{\sqrt{x}}\, dx</m> with,
          and without, substitution.
        </p>
      </statement>
      <solution>
        <p>
          We already know how to integrate this particular example.
          Rewrite <m>\sqrt{x}</m> as
          <m>x^\frac12</m> and simplify the fraction:
          <me>
            \frac{x^2+2x+3}{x^{1/2}} = x^\frac32 + 2x^\frac12 + 3x^{-\frac12}
          </me>.
        </p>

        <p>
          We can now integrate using the Power Rule:
          <md>
            <mrow>\int \frac{x^2+2x+3}{x^{1/2}}\, dx \amp = \int\left(x^\frac32 + 2x^\frac12 + 3x^{-\frac12}\right)\, dx</mrow>
            <mrow>\amp =	\frac25x^\frac52 + \frac43x^\frac32 + 6x^\frac12 + C</mrow>
          </md>
        </p>

        <p>
          This is a perfectly fine approach.
          We demonstrate how this can also be solved using substitution as its implementation is rather clever.
        </p>

        <p>
          Let <m>u = \sqrt{x} = x^\frac12</m>; therefore
          <me>
            du = \frac{1}{2\sqrt{x}}\, dx \quad  \Rightarrow \quad  2du = \frac{1}{\sqrt{x}}\, dx
          </me>.
        </p>

        <p>
          This gives us <m>\ds \int \frac{x^2+2x+3}{\sqrt{x}}\, dx = \int (x^2+2x+3)\cdot2\, du</m>.
          What are we to do with the other <m>x</m> terms?
          Since <m>u = x^\frac12</m>, <m>u^2 = x</m>, etc.
          We can then replace <m>x^2</m> and <m>x</m> with appropriate powers of <m>u</m>.
          We thus have
          <md>
            <mrow>\int \frac{x^2+2x+3}{\sqrt{x}}\, dx \amp = \int (x^2+2x+3)\cdot2\, du</mrow>
            <mrow>\amp = \int 2(u^4 + 2u^2 + 3)\, du</mrow>
            <mrow>\amp = \frac25u^5 + \frac43u^3 + 6u + C</mrow>
            <mrow>\amp = \frac25x^\frac52 + \frac43x^\frac32 + 6x^\frac12+C</mrow>
          </md>,
          which is obviously the same answer we obtained before.
          In this situation,
          substitution is arguably more work than our other method.
          The fantastic thing is that it works.
          It demonstrates how flexible integration is.
        </p>
      </solution>
    </example>
  </subsection>

  <subsection>
    <title>Substitution and Inverse Trigonometric Functions</title>
    <p>
      When studying derivatives of inverse functions, we learned that
      <me>
        \frac{d}{dx}\big(\tan^{-1}(x) \big) = \frac{1}{1+x^2}
      </me>.
    </p>

    <p>
      Applying the Chain Rule to this is not difficult; for instance,
      <me>
        \frac{d}{dx}\big(\tan^{-1}(5x) \big) = \frac{5}{1+25x^2}
      </me>.
    </p>

    <p>
      We now explore how Substitution can be used to <q>undo</q>
      certain derivatives that are the result of the Chain Rule applied to Inverse Trigonometric functions.
      We begin with an example.
    </p>

    <example xml:id="ex_subst14">
      <title>Integrating by substitution: inverse trigonometric functions</title>
      <statement>
        <p>
          Evaluate <m>\ds \int \frac{1}{25+x^2}\, dx</m>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="skYWHK8feRs" xml:id="vid-int-sub-ex-arctan" label="vid-int-sub-ex-arctan" component="video"/>
      </solution>
      <solution>
        <p>
          The integrand looks similar to the derivative of the arctangent function.
          Note:
          <md>
            <mrow>\frac{1}{25+x^2} \amp = \frac{1}{25\left(1+\frac{x^2}{25}\right)}</mrow>
            <mrow>\amp = \frac{1}{25(1+\left(\frac{x}{5}\right)^2)}</mrow>
            <mrow>\amp = \frac{1}{25}\frac{1}{1+\left(\frac{x}{5}\right)^2}</mrow>
          </md>.
        </p>

        <p>
          Thus
          <me>
            \int\frac{1}{25+x^2}\, dx = \frac{1}{25}\int \frac{1}{1+\left(\frac{x}{5}\right)^2}\, dx
          </me>.
        </p>

        <p>
          This can be integrated using Substitution.
          Set <m>u = x/5</m>, hence <m>du = dx/5</m> or <m>dx=5\, du</m>.
          Thus
          <md>
            <mrow>\int\frac{1}{25+x^2}\, dx \amp = \frac{1}{25}\int \frac{1}{1+\left(\frac{x}{5}\right)^2}\, dx</mrow>
            <mrow>\amp = \frac15\int \frac{1}{1+u^2}\, du</mrow>
            <mrow>\amp = \frac15\tan^{-1}(u) + C</mrow>
            <mrow>\amp = \frac15\tan^{-1}\left(\frac x5\right)+C</mrow>
          </md>
        </p>
      </solution>
    </example>

    <p>
      <xref ref="ex_subst14">Example</xref>
      demonstrates a general technique that can be applied to other integrands that result in inverse trigonometric functions.
      The results are summarized here.
    </p>

    <theorem xml:id="thm_int_inverse_trig">
      <title>Integrals Involving Inverse Trigonometric Functions</title>
      <statement>
        <p>
          Let <m>a \gt 0</m>.
        </p>

        <p>
          <ol>
            <li><m>\int \frac{1}{a^2+x^2}\, dx = \frac1a\tan^{-1}\left(\frac{x}{a}\right) + C</m></li>

            <li><m>\int \frac{1}{\sqrt{a^2-x^2}}\, dx = \sin^{-1}\left(\frac{x}{a}\right)+C</m></li>

            <li><m>\int \frac{1}{x\sqrt{x^2-a^2}}\, dx = \frac1a\sec^{-1}\left(\frac{\abs{x}}{a}\right)+C</m></li>
          </ol>
        </p>
      </statement>
    </theorem>

    <p>
      Let's practice using <xref ref="thm_int_inverse_trig">Theorem</xref>.
    </p>

    <example xml:id="ex_subst15">
      <title>Integrating by substitution: inverse trigonometric functions</title>
      <statement>
        <p>
          Evaluate the given indefinite integrals:
          <ol cols="3">
            <li><m>\int \frac{1}{9+x^2}\, dx</m></li>

            <li><m>\int \frac{1}{\sqrt{5-x^2}}\, dx</m></li>

            <li><m>\int \frac{1}{x\sqrt{x^2-\frac{1}{100}}}\, dx</m></li>
          </ol>
        </p>
      </statement>
      <solution>
        <p>
          Each can be answered using a straightforward application of <xref ref="thm_int_inverse_trig">Theorem</xref>.

          <ol>
            <li>
              <p>
                <m>\ds \int \frac{1}{9+x^2}\, dx = \frac13\tan^{-1}\left(\frac x3\right) + C</m>,
                as <m>a = 3</m>.
              </p>
            </li>

            <li>
              <p>
                <m>\ds \int \frac{1}{\sqrt{5-x^2}} = \sin^{-1}\left(\frac{x}{\sqrt{5}}\right)+C</m>,
                as <m>a = \sqrt{5}</m>.
              </p>
            </li>

            <li>
              <p>
                <m>\ds \int \frac{1}{x\sqrt{x^2-\frac{1}{100}}}\, dx = 10\sec^{-1}(10x) + C</m>,
                as <m>a = \frac1{10}</m>.
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>

    <p>
      Most applications of <xref ref="thm_int_inverse_trig">Theorem</xref> are not as straightforward.
      The next examples show some common integrals that can still be approached with this theorem.
    </p>

    <example xml:id="ex_subst16">
      <title>Integrating by substitution: completing the square</title>
      <statement>
        <p>
          Evaluate <m>\ds \int\frac{1}{x^2-4x+13}\, dx</m>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="wSrXvtTvUjI" xml:id="vid-int-sub-ex-complet-square" label="vid-int-sub-ex-complet-square" component="video"/>
      </solution>
      <solution>
        <p>
          Initially, this integral seems to have nothing in common with the integrals in <xref ref="thm_int_inverse_trig">Theorem</xref>.
          As it lacks a square root,
          it almost certainly is not related to arcsine or arcsecant.
          It is, however, related to the arctangent function.
        </p>

        <p>
          We see this by <em>completing the square</em> in the denominator.
          We give a brief reminder of the process here.
        </p>

        <p>
          Start with a quadratic with a leading coefficient of 1.
          It will have the form of <m>x^2 + bx + c</m>.
          Take 1/2 of <m>b</m>, square it,
          and add/subtract it back into the expression.
          <ie/>,
          <md>
            <mrow>x^2+bx+ c \amp = \underbrace{x^2 + bx + \frac{b^2}4}_{(x+b/2)^2} - \frac{b^2}4 + c</mrow>
            <mrow>\amp = \left(x+\frac b2\right)^2 + c-\frac{b^2}4</mrow>
          </md>
        </p>

        <p>
          In our example,
          we take half of <m>-4</m> and square it, getting <m>4</m>.
          We add/subtract it into the denominator as follows:
          <md>
            <mrow>\frac{1}{x^2-4x+13} \amp = \frac{1}{\underbrace{x^2-4x+4}_{(x-2)^2}-4+13}</mrow>
            <mrow>\amp =\frac{1}{(x-2)^2 + 9}</mrow>
          </md>
        </p>

        <p>
          We can now integrate this using the arctangent rule.
          Technically, we need to substitute first with <m>u=x-2</m>,
          but we can employ <xref ref="idea_linearsub">Key Idea</xref> instead.
          Thus we have
          <md>
            <mrow>\int \frac{1}{x^2-4x+13}\, dx \amp = \int \frac{1}{(x-2)^2+9}\, dx</mrow>
            <mrow>\amp = \frac13\tan^{-1}\left(\frac{x-2}{3}\right)+C</mrow>
          </md>.
        </p>
      </solution>
    </example>

    <example xml:id="ex_subst17">
      <title>Integrals requiring multiple methods</title>
      <statement>
        <p>
          Evaluate <m>\ds \int \frac{4-x}{\sqrt{16-x^2}}\, dx</m>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="tEPUnupFCfs" xml:id="vid-int-sub-ex-two-methods" label="vid-int-sub-ex-two-methods" component="video"/>
      </solution>
      <solution>
        <p>
          This integral requires two different methods to evaluate it.
          We get to those methods by splitting up the integral into two terms:
          <me>
            \int \frac{4-x}{\sqrt{16-x^2}}\, dx = \int \frac{4}{\sqrt{16-x^2}}\, dx - \int \frac{x}{\sqrt{16-x^2}}\, dx
          </me>.
        </p>

        <p>
          We handle each separately.
          The first integral is handled using a straightforward application of <xref ref="thm_int_inverse_trig">Theorem</xref>:
        </p>

        <p>
          <m>\ds \int \frac{4}{\sqrt{16-x^2}}\, dx = 4\sin^{-1}\left(\frac{x}{4}\right) + C</m>.
        </p>

        <p>
          The second integral is handled by substitution, with <m>u = 16-x^2</m>.
          <m>\ds \int\frac{x}{\sqrt{16-x^2}}\, dx</m>: Set <m>u = 16-x^2</m>,
          so <m>du = -2x\, dx</m> and <m>x\, dx = -du/2</m>.
          We have
          <md>
            <mrow>\int\frac{x}{\sqrt{16-x^2}}\, dx \amp = \int\frac{-du/2}{\sqrt{u}}</mrow>
            <mrow>\amp = -\frac12\int \frac{1}{\sqrt{u}}\, du</mrow>
            <mrow>\amp = - \sqrt{u} + C</mrow>
            <mrow>\amp = -\sqrt{16-x^2} + C</mrow>
          </md>.
        </p>

        <p>
          Combining these together, we have
          <me>
            \int \frac{4-x}{\sqrt{16-x^2}}\, dx = 4\sin^{-1}\left(\frac{x}{4}\right) + \sqrt{16-x^2}+C
          </me>.
          As with all definite integrals,
          you can check your work by differentiation.
        </p>
      </solution>
    </example>
  </subsection>

  <subsection xml:id="sec-sub-def-int">
    <title>Substitution and Definite Integration</title>
    <figure xml:id="vid_int_sub_def_int" component="video">
      <caption>Video introduction to <xref ref="sec-sub-def-int"/></caption>
      <video youtube="JGD5OtxoKoI" label="vid_int_sub_def_int"/>
    </figure>

    <p>
      This section has focused on evaluating indefinite integrals as we are learning a new technique for finding antiderivatives.
      However, much of the time integration is used in the context of a definite integral.
      Definite integrals that require substitution can be calculated using the following workflow:
    </p>

    <p>
      <ol>
        <li>
          <p>
            Start with a definite integral
            <m>\ds \int_a^b f(x)\, dx</m> that requires substitution.
          </p>
        </li>

        <li>
          <p>
            Ignore the bounds; use substitution to evaluate
            <m>\ds \int f(x)\, dx</m> and find an antiderivative <m>F(x)</m>.
          </p>
        </li>

        <li>
          <p>
            Evaluate <m>F(x)</m> at the bounds;
            that is, evaluate <m>F(x)\Big|_a^b = F(b) - F(a)</m>.
          </p>
        </li>
      </ol>
    </p>

    <p>
      This workflow works fine,
      but substitution offers an alternative that is powerful and amazing
      (and a little time saving).
    </p>

    <p>
      At its heart,
      (using the notation of <xref ref="thm_subst">Theorem</xref>)
      substitution converts integrals of the form
      <m>\int \Fp(g(x))g'(x)\, dx</m> into an integral of the form
      <m>\int \Fp(u)\, du</m> with the substitution of <m>u = g(x)</m>.
      The following theorem states how the bounds of a definite integral can be changed as the substitution is performed.
    </p>

    <theorem xml:id="thm_subst_def_int">
      <title>Substitution with Definite Integrals</title>
      <statement>
        <p>
          Let <m>F</m> and <m>g</m> be differentiable functions,
          where the range of <m>g</m> is an interval <m>I</m> that is contained in the domain of <m>F</m> and <m>u=g(x)</m>.
          Then

          <idx><h>integration</h><h>definite!and substitution</h></idx>

          <idx><h>definite integral</h><h>and substitution</h></idx>

          <me>
            \int_a^b \Fp\big(g(x)\big)g'(x)\, dx = \int_{g(a)}^{g(b)} \Fp(u)\, du
          </me>.
        </p>
      </statement>
    </theorem>

    <p>
      In effect, <xref ref="thm_subst_def_int">Theorem</xref>
      states that once you convert to integrating with respect to <m>u</m>,
      you do not need to switch back to evaluating with respect to <m>x</m>.
      A few examples will help one understand.
    </p>

    <example xml:id="ex_sub12">
      <title>Definite integrals and substitution: changing the bounds</title>
      <statement>
        <p>
          Evaluate <m>\ds\int_0^2 \cos(3x-1)\, dx</m> using <xref ref="thm_subst_def_int">Theorem</xref>.
        </p>
      </statement>
      <solution>
        <p>
          Observing the composition of functions,
          let <m>u=3x-1</m>, hence <m>du = 3\, dx</m>.
          As <m>3\, dx</m> does not appear in the integrand,
          divide the latter equation by 3 to get <m>du/3 = dx</m>.
        </p>

        <p>
          By setting <m>u = 3x-1</m>, we are implicitly stating that <m>g(x) = 3x-1</m>.
          <xref ref="thm_subst_def_int">Theorem</xref>
          states that the new lower bound is <m>g(0) = -1</m>;
          the new upper bound is <m>g(2) = 5</m>.
          We now evaluate the definite integral:
          <md>
            <mrow>\int_0^2 \cos(3x-1) \, dx \amp =	\int_{-1}^5 \cos(u) \frac{du}{3}</mrow>
            <mrow>\amp = \frac{1}{3} \sin(u) \Big|_{-1}^5</mrow>
            <mrow>\amp = \frac{1}{3}\big(\sin(5) - \sin(-1)\big)</mrow>
            <mrow>\amp \approx -0.039</mrow>
          </md>.
        </p>

        <p>
          Notice how once we converted the integral to be in terms of <m>u</m>,
          we never went back to using <m>x</m>.
        </p>

        <figure xml:id="fig_subst12">
          <caption>Graphing the areas defined by the definite integrals of <xref ref="ex_sub12">Example</xref></caption>
          <sidebyside widths="47% 47%" margins="0%">
            <figure xml:id="fig_subst12a">
              <caption/>
            <!-- START figures/fig_subst12a.tex -->
              <image xml:id="img_subst12a">
                <description></description>
                <latex-image>

                \begin{tikzpicture}

                \begin{axis}[
                axis on top,
                xtick={-1,1,2,3,4,5},
                ymin=-1.1,ymax=1.1,
                xmin=-1.5,xmax=5.5]

                \addplot [firstcurvestyle,areastyle,domain=0:2] {cos(deg(3*x-1))} \closedcycle;
                \addplot [firstcurvestyle,-,domain=-1.5:5.5,samples=140] {cos(deg(3*x-1))} node [pos=0.54, above right]{ $y=\cos(3x-1)$};

                \end{axis}

                \end{tikzpicture}

                </latex-image>
              </image>

            </figure>
            <!-- figures/fig_subst12a.tex END -->
            <figure xml:id="fig_subst12b">
              <caption/>
            <!-- START figures/fig_subst12b.tex -->
              <image xml:id="img_subst12b">
                <description></description>
                <latex-image>

                \begin{tikzpicture}

                \begin{axis}[
                axis on top,
                xtick={-1,1,2,3,4,5},
                ymin=-1.1,ymax=1.1,
                xmin=-1.5,xmax=5.5,
                xlabel={$u$},
                ]

                \addplot [firstcurvestyle,areastyle,domain=-1:5] {cos(deg(x))/3} \closedcycle;
                \addplot [firstcurvestyle,-,domain=-1.5:5.5,samples=40] {cos(deg(x))/3} node [pos=0.45, above right] { $y=\frac13\cos(u)$};

                \end{axis}

                \end{tikzpicture}

                </latex-image>
              </image>
            <!-- figures/fig_subst12b.tex END -->
            </figure>
          </sidebyside>
        </figure>

        <p>
          The graphs in <xref ref="fig_subst12">Figure</xref> tell more of the story.
          In <xref ref="fig_subst12a">Figure</xref>
          the area defined by the original integrand is shaded,
          whereas in <xref ref="fig_subst12b">Figure </xref>
          the area defined by the new integrand is shaded.
          In this particular situation,
          the areas look very similar;
          the new region is <q>shorter</q>
          but <q>wider,</q> giving the same area.
        </p>
      </solution>
    </example>

    <example xml:id="ex_subst13">
      <title>Definite integrals and substitution: changing the bounds</title>
      <statement>
        <p>
          Evaluate <m>\ds \int_0^{\pi/2} \sin(x) \cos(x) \, dx</m> using <xref ref="thm_subst_def_int">Theorem</xref>.
        </p>
      </statement>
      <solution component="video">
        <title>Video solution</title>
        <video width="98%" youtube="U3B47kxjidk" xml:id="vid_int_sub_def_int_ex" label="vid_int_sub_def_int_ex" component="video"/>
      </solution>
      <solution>

        <p>
          We saw the corresponding indefinite integral in <xref ref="ex_sub10">Example</xref>.
          In that example we set <m>u = \sin(x)</m> but stated that we could have let <m>u = \cos(x)</m>.
          For variety, we do the latter here.
        </p>

        <p>
          Let <m>u = g(x) = \cos(x)</m>,
          giving <m>du = -\sin(x) \, dx</m> and hence <m>\sin(x) \, dx = -du</m>.
          The new upper bound is <m>g(\pi/2) = 0</m>;
          the new lower bound is <m>g(0) = 1</m>.
          Note how the lower bound is actually larger than the upper bound now.
          We have
          <md>
            <mrow>\int_0^{\pi/2} \sin(x) \cos(x) \, dx \amp = \int_1^0 -u\, du \quad \text{(switch bounds and change sign) }</mrow>
            <mrow>\amp =	\int_0^1 u\, du</mrow>
            <mrow>\amp = \frac12u^2\Big|_0^1= 1/2</mrow>
          </md>.
        </p>

        <p>
          In <xref ref="fig_subst13">Figure</xref>
          we have again graphed the two regions defined by our definite integrals.
          Unlike the previous example, they bear no resemblance to each other.
          However, <xref ref="thm_subst_def_int">Theorem</xref>
          guarantees that they have the same area.
        </p>

       <figure xml:id="fig_subst13">
        <caption>Graphing the areas defined by the definite integrals of <xref ref="ex_subst13">Example</xref></caption>
          <sidebyside widths="47% 47%" margins="0%">
            <figure xml:id="fig_subst13a">
              <caption/>
              <!-- START figures/fig_subst13a.tex -->
              <image xml:id="img_subst13a">
                <description></description>
                <latex-image>

                \begin{tikzpicture}

                \begin{axis}[
                axis on top,
                xtick=\empty,
                extra x ticks={1.57},
                extra x tick labels={$\frac{\pi}{2}$},
                ymin=-.6,ymax=1.1,
                xmin=-.5,xmax=2
                ]

                \addplot [firstcurvestyle,areastyle,domain=0:1.57] {cos(deg(x))*sin(deg(x)} \closedcycle;
                \addplot [firstcurvestyle,-,domain=-.5:2,samples=40] {cos(deg(x))*sin(deg(x)} node [pos=0.5, above right] { $y=\sin(x) \cos(x)$};

                \end{axis}
                \end{tikzpicture}

                </latex-image>
              </image>
              <!-- figures/fig_subst13a.tex END -->

            </figure>

            <figure xml:id="fig_subst13b">
              <caption/>
                <!-- START figures/fig_subst13b.tex -->
                <image xml:id="img_subst13b">
                  <description></description>
                  <latex-image>

                  \begin{tikzpicture}

                  \begin{axis}[
                  axis on top,
                  xtick={1},
                  extra x ticks={1.57},
                  extra x tick labels={$\frac{\pi}{2}$},ymin=-.6,ymax=1.1,
                  xmin=-.5,xmax=2,
                  xlabel={$u$}
                  ]

                  \addplot [firstcurvestyle,areastyle,domain=0:1] {x} \closedcycle;
                  \addplot [firstcurvestyle,-,domain=-.5:1.1] {x} node [pos=0.9, right] { $y=u$};

                  \end{axis}
                  \end{tikzpicture}

                  </latex-image>
                </image>
                <!-- figures/fig_subst13b.tex END -->
            </figure>
          </sidebyside>
        </figure>
      </solution>
    </example>

    <p>
      Integration by substitution is a powerful and useful integration technique.
      The next section introduces another technique,
      called Integration by Parts.
      As substitution <q>undoes</q> the Chain Rule,
      integration by parts <q>undoes</q> the Product Rule.
      Together, these two techniques provide a strong foundation on which most other integration techniques are based.
    </p>
  </subsection>

  <exercises>
    <subexercises xml:id="TaC-integrate-substitution">
      <title>Terms and Concepts</title>
      <exercise label="TaC-integrate-substitution-1">
        <webwork xml:id="webwork-TaC-integrate-substitution-1">
          <pg-code>
            Context()->strings->add('the Chain Rule'=>{});
            Context()->strings->add('Chain Rule'=>{alias=>'the Chain Rule'});
            Context()->strings->add('Chain'=>{alias=>'the Chain Rule'});
          </pg-code>
          <statement>
            <p>
              Substitution <q>undoes</q> what derivative rule?
            </p>
            <p>
              <var name="'the Chain Rule'" width="40"/>
            </p>
          </statement>
        </webwork>
      </exercise>

      <exercise label="TaC-integrate-substitution-2">
        <webwork xml:id="webwork-TaC-integrate-substitution-2">
          <pg-code>
            $true=PopUp(['?','True','False'],1);
          </pg-code>
          <statement>
            <p>
              <var name="$true" form="popup"/>
              One can use algebra to rewrite the integrand of an integral to make it easier to evaluate.
            </p>
          </statement>
        </webwork>
      </exercise>
    </subexercises>

    <subexercises>
      <title>Problems</title>
      <exercisegroup cols="2" xml:id="exset-integrate-substitution-evaluate">
        <introduction>
          <p>
            Evaluate the indefinite integral to develop an understanding of Substitution.
          </p>
        </introduction>

        <exercise label="ex-integrate-substitution-evaluate-1">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-1">
            <pg-code>
              $m = random(3,4,1);
              $b = non_zero_random(-9,9,1);
              $n = random(5,9,1);
              if($envir{problemSeed}==1){$m=3;$b=-5;$n=7;};
              Context("Fraction");
              $u = Formula("x^$m+$b")->reduce;
              $du = $u->D('x');
              $f = $du * Formula("($u)^$n");
              $F = FormulaUpToConstant("1/($n+1)*($u)^($n+1)");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise label="ex-integrate-substitution-evaluate-2">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-2">
            <pg-code>
              ($m,$b) = (-9..-1,1..9)[NchooseK(18,2)];
              $n = random(3,9,1);
              if($envir{problemSeed}==1){$m=-5;$b=7;$n=3;};
              Context("Fraction");
              $u = Formula("x^2+$m x+$b")->reduce;
              $du = $u->D('x');
              $f = $du * Formula("($u)^$n");
              $F = FormulaUpToConstant("1/($n+1)*($u)^($n+1)");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 5 -->
        <exercise label="ex-integrate-substitution-evaluate-3">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-3">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              $n = random(3,9,1);
              if($envir{problemSeed}==1){$b=1;$n=8;};
              Context("Fraction");
              $u = Formula("x^2+$b")->reduce;
              $f = Formula("x ($u)^$n");
              $F = FormulaUpToConstant("1/(2*($n+1))*($u)^($n+1)");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 6 -->
        <exercise label="ex-integrate-substitution-evaluate-4">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-4">
            <pg-code>
              ($a,$b,$c) = (-9..-1,1..9)[NchooseK(18,3)];
              $n = random(3,9,1);
              $s = random(2,4,1);
              if($envir{problemSeed}==1){$a=3;$b=7;$c=-1;$n=5;$s=2;};
              Context("Fraction");
              $u = Formula("$a x^2 + $b x + $c")->reduce;
              $f = Formula("(2*$a*$s x + $b*$s) ($u)^$n")->reduce;
              $frac = Fraction($s,$n+1);
              $F = FormulaUpToConstant("$frac*($u)^($n+1)");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 7 -->
        <exercise label="ex-integrate-substitution-evaluate-5">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-5">
            <pg-code>
              ($m,$b) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$m=2;$b=7;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [-$b/$m-2,-$b/$m+2]});
              $f = Formula("1/($m x + $b)")->reduce;
              $F = FormulaUpToConstant("1/$m ln(abs($m x + $b))")->reduce;
              $F->{test_at} = [[-$b/$m-2],[-$b/$m+2]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 8-->
        <exercise label="ex-integrate-substitution-evaluate-6">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-6">
            <pg-code>
              ($m,$b) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$m=2;$b=3;};
              Context("Fraction");
              $f = Formula("1/sqrt($m x + $b)")->reduce;
              $frac = Fraction(2,$m);
              $F = FormulaUpToConstant("$frac sqrt($m x + $b)")->reduce;
              $F->{limits} = [-$b/$m,-$b/$m+4];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 9 -->
        <exercise label="ex-integrate-substitution-evaluate-7">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-7">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$b=3;};
              Context("Fraction");
              $f = Formula("x/sqrt(x + $b)")->reduce;
              $F = FormulaUpToConstant("2/3 (x - 2*$b) sqrt(x + $b)")->reduce;
              $F->{limits} = [-$b,-$b+4];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 10 -->
        <exercise label="ex-integrate-substitution-evaluate-8">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-8">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              $m = random(3,5,1);
              if($envir{problemSeed}==1){$m=3;$b=-1;};
              Context("Fraction");
              $f = Formula("(x^$m+$b x)/sqrt(x)")->reduce;
              $frac = Fraction(2*$b,3);
              $F = FormulaUpToConstant("x^(3/2) (2/(2*$m+1) x^($m-1) + $frac )")->reduce;
              $F->{limits} = [0,4];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 11 -->
        <exercise label="ex-integrate-substitution-evaluate-9">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-9">
            <pg-code>
              $F = FormulaUpToConstant("2*e^sqrt(x)");
              $F->{limits} = [0,4];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \frac{e^{\sqrt{x}}}{\sqrt{x}} dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 12 -->
        <exercise label="ex-integrate-substitution-evaluate-10">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-10">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              $m = random(4,8,1);
              if($envir{problemSeed}==1){$m=5;$b=1;};
              Context("Fraction");
              $f = Formula("x^($m-1)/sqrt(x^$m+$b)")->reduce;
              $frac = Fraction(2,$m);
              $F = FormulaUpToConstant("$frac sqrt(x^$m+$b)")->reduce;
              if ($b &lt; 0) {
                $absb = abs($b);
                $F->{limits} = [$absb**(1/$m)+1,$absb**(1/$m)+4];
              }
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 13 -->
        <exercise label="ex-integrate-substitution-evaluate-11">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-11">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              $m = random(1,3,1);
              if($envir{problemSeed}==1){$m=1;$b=1;};
              Context("Fraction");
              $f = Formula("(1/x^$m + $b)/x^($m+1)")->reduce;
              $frac = Fraction(2,$m);
              $F = FormulaUpToConstant("-1/(2*$m) (1/x^$m + $b)^2")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 14 -->
        <exercise label="ex-integrate-substitution-evaluate-12">
          <webwork xml:id="webwork-ex-integrate-substitution-evaluate-12">
            <pg-code>
              $F = FormulaUpToConstant("ln(x)^2/2");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \frac{\ln(x)}{x} dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2" xml:id="exset-substitution-trig">
        <introduction>
          <p>
            Use Substitution to evaluate the indefinite integral involving trigonometric functions.
          </p>
        </introduction>
        <!-- Exercise 15 -->
        <exercise label="ex-substitution-trig-1">
          <webwork xml:id="webwork-ex-substitution-trig-1">
            <pg-code>
              $m = random(2,9,1);
              if($envir{problemSeed}==1){$m=2;};
              Context("Fraction");
              $f = Formula("sin^$m(x) cos(x)")->reduce;
              $F = FormulaUpToConstant("sin^($m+1)(x)/($m+1)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \sin^{<var name="$m"/>}(x) \cos(x) \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise label="ex-substitution-trig-2">
          <webwork xml:id="webwork-ex-substitution-trig-2">
            <pg-code>
              $m = random(2,9,1);
              if($envir{problemSeed}==1){$m=3;};
              Context("Fraction");
              $f = Formula("cos^$m(x) sin(x)")->reduce;
              $F = FormulaUpToConstant("-cos^($m+1)(x)/($m+1)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \cos^{<var name="$m"/>}(x) \sin(x) \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 17 -->
        <exercise label="ex-substitution-trig-3">
          <webwork xml:id="webwork-ex-substitution-trig-3">
            <pg-code>
              $m = random(-9,-1,1);
              $b = random(1,9,1);
              $trig = list_random('sin','cos');
              if($envir{problemSeed}==1){$m=-6;$b=3;$trig='cos'};
              Context("Fraction");
              $f = Formula("$trig($b+$m x)")->reduce;
              $trigAD =Formula("-$trig(x)")->D('x');
              $F = $trigAD->substitute(x=>Formula("$b+$m x"));
              $F = FormulaUpToConstant("$F/$m")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 18 -->
        <exercise label="ex-substitution-trig-4">
          <webwork xml:id="webwork-ex-substitution-trig-4">
            <pg-code>
              $m = random(-9,-1,1);
              $b = random(1,9,1);
              if($envir{problemSeed}==1){$m=-1;$b=4;};
              Context("Fraction");
              $g = Formula("$b + $m x")->reduce;
              $f = Formula("sec^2($b + $m x)")->reduce;
              $F = FormulaUpToConstant("tan($b + $m x)/$m")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \sec^2(<var name="$g"/>) \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 19 -->
        <exercise label="ex-substitution-trig-5">
          <webwork xml:id="webwork-ex-substitution-trig-5">
            <pg-code>
              $m = random(2,9,1);
              if($envir{problemSeed}==1){$m=2;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [0,2*pi/$m]});
              $f = Formula("sec($m x)")->reduce;
              $F = FormulaUpToConstant("1/$m ln(abs(sec($m x) + tan($m x)))")->reduce;
              $F->{test_at} = [[pi/4/$m],[3*pi/4/$m],[5*pi/4/$m],[7*pi/4/$m]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 20 -->
        <exercise label="ex-substitution-trig-6">
          <webwork xml:id="webwork-ex-substitution-trig-6">
            <pg-code>
              $m = random(2,9,1);
              if($envir{problemSeed}==1){$m=2;};
              Context("Fraction");
              $f = Formula("tan^$m(x) sec^2(x)")->reduce;
              $F = FormulaUpToConstant("1/($m+1) tan^($m+1)(x)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \tan^{<var name="$m"/>}(x)\sec^2(x) \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 21 -->
        <exercise label="ex-substitution-trig-7">
          <webwork xml:id="webwork-ex-substitution-trig-7">
            <pg-code>
              $m = random(2,9,1);
              $trig = list_random('sin','cos');
              if($envir{problemSeed}==1){$m=2;$trig='cos'};
              Context("Fraction");
              $f = Formula("x^($m-1) $trig(x^$m)")->reduce;
              $trigAD = Formula("-$trig(x)")->D('x');
              $F = $trigAD->substitute(x=>Formula("x^$m"));
              $F = FormulaUpToConstant("1/($m) $F")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 22 -->
        <exercise label="ex-substitution-trig-8">
          <webwork xml:id="webwork-ex-substitution-trig-8">
            <pg-code>
              $F = FormulaUpToConstant("tan(x)-x");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \tan^2(x) dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 23 -->
        <exercise label="ex-substitution-trig-9">
          <webwork xml:id="webwork-ex-substitution-trig-9">
            <pg-code>
              Context()->variables->set(x => {limits => [0,2*pi]});
              $F = FormulaUpToConstant("ln(abs(sin(x)))");
              $F->{test_at} = [[pi/4],[3*pi/4],[5*pi/4],[7*pi/4]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \cot(x) \, dx</m>
              </p>
              <p>
                Do not just refer to <xref ref="thm_triganti">Theorem</xref> for the answer;
                justify it through Substitution.
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 24 -->
        <exercise label="ex-substitution-trig-10">
          <webwork xml:id="webwork-ex-substitution-trig-10">
            <pg-code>
              Context()->variables->set(x => {limits => [0,2*pi]});
              $F = FormulaUpToConstant("-ln(abs(csc(x) + cot(x)))");
              $F->{test_at} = [[pi/4],[3*pi/4],[5*pi/4],[7*pi/4]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \csc(x) \, dx</m>
              </p>
              <p>
                Do not just refer to <xref ref="thm_triganti">Theorem</xref> for the answer;
                justify it through Substitution.
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2" xml:id="exset-substitution-exponential">
        <introduction>
          <p>
            Use Substitution to evaluate the indefinite integral involving exponential functions.
          </p>
        </introduction>
        <!-- Exercise 25 -->
        <exercise label="ex-substitution-exponential-1">
          <webwork xml:id="webwork-ex-substitution-exponential-1">
            <pg-code>
              $m = random(2,9,1);
              $b = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$m=3;$b=-1};
              Context("Fraction");
              $f = Formula("e^($m x+$b)")->reduce;
              $F = FormulaUpToConstant("1/$m e^($m x+$b)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 26 -->
        <exercise label="ex-substitution-exponential-2">
          <webwork xml:id="webwork-ex-substitution-exponential-2">
            <pg-code>
              $m = random(2,9,1);
              if($envir{problemSeed}==1){$m=3;};
              Context("Fraction");
              $f = Formula("e^(x^$m)x^($m-1)")->reduce;
              $F = FormulaUpToConstant("1/$m e^(x^$m)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 27 -->
        <exercise label="ex-substitution-exponential-3">
          <webwork xml:id="webwork-ex-substitution-exponential-3">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$b=-1};
              Context("Fraction");
              Context()->variables->set(x => {limits => [-$b-2,-$b+2]});
              $f = Formula("e^(x^2 + 2*$b x + ($b)^2) (x + $b)")->reduce;
              $F = FormulaUpToConstant("1/2 e^((x+$b)^2)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 28 -->
        <exercise label="ex-substitution-exponential-4">
          <webwork xml:id="webwork-ex-substitution-exponential-4">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$b=1};
              Context("Fraction");
              $f = Formula("(e^x+$b)/e^x")->reduce;
              $F = FormulaUpToConstant("x - $b e^(-x)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise label="ex-substitution-exponential-5">
          <webwork xml:id="webwork-ex-substitution-exponential-5">
            <pg-code>
              $b = non_zero_random(1,9,1);
              if($envir{problemSeed}==1){$b=1};
              Context("Fraction");
              $f = Formula("e^x/(e^x+$b)")->reduce;
              $F = FormulaUpToConstant("ln(e^x+$b)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 30 -->
        <exercise label="ex-substitution-exponential-6">
          <webwork xml:id="webwork-ex-substitution-exponential-6">
            <pg-code>
              $c = list_random(-1,1);
              $m = random(2,5,1);
              if($envir{problemSeed}==1){$c=-1;$m=2;};
              Context("Fraction");
              $f = Formula("(e^x + $c e^(-x))/e^($m x)")->reduce;
              $F = FormulaUpToConstant("1/(1-$m) e^((1-$m)x) + $c/(-1-$m) e^((-1-$m)x)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 31 -->
        <exercise label="ex-substitution-exponential-7">
          <webwork xml:id="webwork-ex-substitution-exponential-7">
            <pg-code>
              $b = random(2,9,1);
              if($envir{problemSeed}==1){$b=3;};
              Context("Fraction");
              $f = Formula("$b^($b x)")->reduce;
              Context()->flags->set(reduceConstantFunctions=>0);
              $F = FormulaUpToConstant("$b^($b x)/($b ln($b))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 32 -->
        <exercise label="ex-substitution-exponential-8">
          <webwork xml:id="webwork-ex-substitution-exponential-8">
            <pg-code>
              ($b,$c) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$b=4;$c=2;};
              Context("Fraction");
              $f = Formula("$b^($c x)")->reduce;
              Context()->flags->set(reduceConstantFunctions=>0);
              $F = FormulaUpToConstant("$b^($c x)/($c ln($b))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2" xml:id="exset-substitution-logarithmic">
        <introduction>
          <p>
            Use Substitution to evaluate the indefinite integral involving logarithmic functions.
          </p>
        </introduction>
        <!-- Exercise 33 -->
        <!-- Repeat of #14 -->
        <exercise label="ex-substitution-logarithmic-1">
          <webwork xml:id="webwork-ex-substitution-logarithmic-1">
            <pg-code>
              $F = FormulaUpToConstant("ln(x)^2/2");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \frac{\ln(x)}{x} dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 34 -->
        <exercise label="ex-substitution-logarithmic-2">
          <webwork xml:id="webwork-ex-substitution-logarithmic-2">
            <pg-code>
              $m = random(2,9,1);
              if($envir{problemSeed}==1){$m=2;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [0.1,10]});
              $f = Formula("(ln(x))^$m/x")->reduce;
              $F = FormulaUpToConstant("(ln(x))^($m+1)/($m+1)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise label="ex-substitution-logarithmic-3">
          <webwork xml:id="webwork-ex-substitution-logarithmic-3">
            <pg-code>
              $m = random(3,9,2);
              if($envir{problemSeed}==1){$m=3;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [0.1,10]});
              $f = Formula("ln(x^$m)/x")->reduce;
              $frac = Fraction($m,2);
              $F = FormulaUpToConstant("$frac (ln(x))^2")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 36 -->
        <exercise label="ex-substitution-logarithmic-4">
          <webwork xml:id="webwork-ex-substitution-logarithmic-4">
            <pg-code>
              $m = random(2,8,2);
              if($envir{problemSeed}==1){$m=2;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [0.1,10]});
              $f = Formula("1/(x ln(x^$m))")->reduce;
              $F = FormulaUpToConstant("1/$m ln(abs(ln(x^$m)))")->reduce;
              $F->{test_at} = [[0.5],[2]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2" xml:id="exset-substitution-rational">
        <introduction>
          <p>
            Use Substitution to evaluate the indefinite integral involving rational functions.
          </p>
        </introduction>
        <!-- Exercise 37 -->
        <exercise label="ex-substitution-rational-1">
          <webwork xml:id="webwork-ex-substitution-rational-1">
            <pg-code>
              ($a,$b) = (-9..-1,1..9)[NchooseK(18,2)];
              if($envir{problemSeed}==1){$a=3;$b=1;};
              Context("Fraction");
              $f = Formula("(x^2 + $a x + $b)/x")->reduce;
              $F = FormulaUpToConstant("x^2/2 + $a x + $b ln(abs(x))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 38 -->
        <exercise label="ex-substitution-rational-2">
          <webwork xml:id="webwork-ex-substitution-rational-2">
            <pg-code>
              Context("Fraction");
              $f = Formula("(x^3 + x^2 + x + 1)/x")->reduce;
              $F = FormulaUpToConstant("x^3/3 + x^2/2 + x + ln(abs(x))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 39 -->
        <exercise label="ex-substitution-rational-3">
          <webwork xml:id="webwork-ex-substitution-rational-3">
            <pg-code>
              $c = list_random(-1,1);
              $b = non_zero_random(-9,9,1);
              if ($b == $c) {$b = list_random(-9..-2,2..9);}
              if($envir{problemSeed}==1){$c=1;$b=-1};
              Context("Fraction");
              Context()->variables->set(x => {limits => [-$c-2,-$c+2]});
              $f = Formula("(x^3 + $b)/(x + $c)")->reduce;
              $frac = Fraction(3*$c,2);
              $F = FormulaUpToConstant("1/3 (x+$c)^3 + $frac (x+$c)^2 + 3*($c)^2 (x+$c) + (($c)^3 + $b) ln(abs(x+$c))")->reduce;
              $F->{test_at} = [[-$c-2],[-$c+2]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 40 -->
        <exercise label="ex-substitution-rational-4">
          <webwork xml:id="webwork-ex-substitution-rational-4">
            <pg-code>
              do {($a,$b,$c) = (-9..-1,1..9)[NchooseK(18,3)];} until ((-$c)^2 + $a*(-$c) + $b != 0);
              if($envir{problemSeed}==1){$a=2;$b=-5;$c=-3;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [-$c-2,-$c+2]});
              $f = Formula("(x^2 + $a x + $b)/(x + $c)")->reduce;
              $F = FormulaUpToConstant("(x+$c)^2/2 + ($a-2*$c)(x+$c) + (($c)^2 - $a*$c + $b)ln(abs(x+$c))")->reduce;
              $F->{test_at} = [[-$c-2],[-$c+2]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 41 -->
        <exercise label="ex-substitution-rational-5">
          <webwork xml:id="webwork-ex-substitution-rational-5">
            <pg-code>
              do {($a,$b,$c,$d) = (-9..-1,1..9)[NchooseK(18,4)];} until ($a*(-$d)^2 + $b*(-$d) + $c != 0);
              if($envir{problemSeed}==1){$a=3;$b=-5;$c=7;$d=1;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [-$d-2,-$d+2]});
              $f = Formula("($a x^2 + $b x + $c)/(x + $d)")->reduce;
              $frac = Fraction($a,2);
              $F = FormulaUpToConstant("$frac (x+$d)^2 + ($b - 2*$a*$d)(x+$d) + ($a*($d)^2 - $b*$d + $c)ln(abs(x+$d))")->reduce;
              $F->{test_at} = [[-$d-2],[-$d+2]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 42 -->
        <exercise label="ex-substitution-rational-6">
          <webwork xml:id="webwork-ex-substitution-rational-6">
            <pg-code>
              ($a,$b,$c) = (-9,-6,-3,0,3,6,9)[NchooseK(7,3)];
              if($envir{problemSeed}==1){$a=3;$b=3;$c=0;};
              Context("Fraction");
              $denom = Formula("x^3 + $a x^2 + $b x + $c")->reduce;
              $A = 2*$a/3;
              $B = $b/3;
              $numer = Formula("x^2 + $A x + $B")->reduce;
              $f = Formula("($numer)/($denom)")->reduce;
              $F = FormulaUpToConstant("1/3 ln(abs($denom))")->reduce;
              $bound = abs($c)+abs($b)+abs($a);  # be sure to test where $denom is pos and neg
              $F->{test_at} = [[-1],[1],[-$bound-1],[$bound+1]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2" xml:id="exset-substitution-invserse-trig">
        <introduction>
          <p>
            Use Substitution to evaluate the indefinite integral involving inverse trigonometric functions.
          </p>
        </introduction>
        <!-- Exercise 43 -->
        <exercise label="ex-substitution-invserse-trig-1">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-1">
            <pg-code>
              $a = list_random(2,3,5,6,7,11,13,14,15,17);
              if($envir{problemSeed}==1){$a=7;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$a/(x^2+$a)")->reduce;
              $F = FormulaUpToConstant("sqrt($a) atan(x/sqrt($a))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 44 -->
        <exercise label="ex-substitution-invserse-trig-2">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-2">
            <pg-code>
              $a = random(2,9,1);
              if($envir{problemSeed}==1){$a=3;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [-$a,$a]});
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$a/sqrt($a^2-x^2)")->reduce;
              $F = FormulaUpToConstant("$a asin(x/$a)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 45 -->
        <exercise label="ex-substitution-invserse-trig-3">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-3">
            <pg-code>
              $a = list_random(2,3,5,6,7,10,11,13,14,15);
              $b = random(2,20,1);
              if($envir{problemSeed}==1){$a=5;$b=14;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [-sqrt($a),sqrt($a)]});
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$b/sqrt($a-x^2)")->reduce;
              $F = FormulaUpToConstant("$b asin(x/sqrt($a))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 46 -->
        <exercise label="ex-substitution-invserse-trig-4">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-4">
            <pg-code>
              ($a,$b) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$a=3;$b=2;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [$a,$a+10]});
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$b/(x sqrt(x^2-$a^2))")->reduce;
              $frac = Fraction($b,$a);
              $F = FormulaUpToConstant("$frac asec(abs(x)/$a)")->reduce;
              $F->{test_at} = [[-$a-1],[-$a-2],[-$a-3],[-$a-4]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 47 -->
        <exercise label="ex-substitution-invserse-trig-5">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-5">
            <pg-code>
              ($a,$b) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$a=4;$b=5;};
              Context("Fraction");
              Context()->variables->set(x => {limits => [$a,$a+10]});
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("($b x)/sqrt(x^6 - ($a)^2 x^4)")->reduce;
              $frac = Fraction($b,$a);
              $F = FormulaUpToConstant("$frac asec(abs(x)/$a)")->reduce;
              $F->{test_at} = [[-$a-1],[-$a-2],[-$a-3],[-$a-4]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 48 -->
        <exercise label="ex-substitution-invserse-trig-6">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-6">
            <pg-code>
              Context()->variables->set(x => {limits => [-1,1]});
              $F = FormulaUpToConstant("1/2*asin(x^2)");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \frac{x}{\sqrt{1-x^4}} dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 49 -->
        <exercise label="ex-substitution-invserse-trig-7">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-7">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              $b = list_random(2,3,5,6,7,10,11,13,14,15);
              if($envir{problemSeed}==1){$a=-1;$b=7;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("1/(x^2 + (2*$a) x + (($a)^2+$b))")->reduce;
              $F = FormulaUpToConstant("1/sqrt($b) atan((x+$a)/$b)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 50 -->
        <exercise label="ex-substitution-invserse-trig-8">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-8">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              ($b,$c) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$a=-3;$b=4;$c=2};
              Context("Fraction");
              Context()->noreduce('(-x)-y','(-x)+y');
              Context()->variables->set(x => {limits => [-$a-$b,-$a+$b]});
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$c/sqrt(-x^2 - (2*$a) x + (($b)^2-($a)^2))")->reduce;
              $F = FormulaUpToConstant("$c asin((x+$a)/$b)")->reduce;
              $F->{limits} = [-$b-$a,$b-$a];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 51 -->
        <exercise label="ex-substitution-invserse-trig-9">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-9">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              ($b,$c) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$a=-4;$b=5;$c=3};
              Context("Fraction");
              Context()->noreduce('(-x)-y','(-x)+y');
              Context()->variables->set(x => {limits => [-$a-$b,-$a+$b]});
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$c/sqrt(-x^2 - (2*$a) x + (($b)^2-($a)^2))")->reduce;
              $F = FormulaUpToConstant("$c asin((x+$a)/$b)")->reduce;
              $F->{limits} = [-$b-$a,$b-$a];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 52 -->
        <exercise label="ex-substitution-invserse-trig-10">
          <webwork xml:id="webwork-ex-substitution-invserse-trig-10">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              $b = random(2,9,1);
              if($envir{problemSeed}==1){$a=3;$b=5};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$b/(x^2+(2*$a)x+(($a)^2+($b)^2))")->reduce;
              $F = FormulaUpToConstant("atan((x+$a)/$b)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2" xml:id="exset-substitution-evaluate-general">
        <introduction>
          <p>
            Evaluate the indefinite integral.
          </p>
        </introduction>
        <!-- Exercise 53 -->
        <exercise label="ex-substitution-evaluate-general-1">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-1">
            <pg-code>
              $m = random(3,9,1);
              $b = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$m=3;$b=3};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("x^($m-1)/(x^$m + $b)^2")->reduce;
              $F = FormulaUpToConstant("-1/($m(x^$m + $b))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 54 -->
        <exercise label="ex-substitution-evaluate-general-2">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-2">
            <pg-code>
              $a = random(1,9,1);
              ($b,$c) = (-9..-1,1..9)[NchooseK(18,2)];
              ($n,$m) = num_sort((2..6)[NchooseK(5,2)]);
              $p = random(4,9,1);
              if($envir{problemSeed}==1){$a=5;$b=5;$c=2;$m=3;$n=2;$p=8;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $u = Formula("$a x^$m + $b x^$n + $c")->reduce;
              $g = gcd($a*$m,$b*$n);
              $A = $a*$m/$g;
              $B = $b*$n/$g;
              $f = Formula("($A x^($m-1) + $B x^($n-1))($u)^$p")->reduce;
              $F = FormulaUpToConstant("1/(($p+1)*$g) ($u)^($p+1)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 55 -->
        <exercise label="ex-substitution-evaluate-general-3">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-3">
            <pg-code>
              $a = random(1,9,1);
              $c = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$a=1;$c=-1;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("x/sqrt($a + $c x^2)")->reduce;
              $frac = Fraction(1,$c);
              $F = FormulaUpToConstant("$frac sqrt($a + $c x^2)")->reduce;
              if ($c &lt; 0) {
                $F->{limits} = [-sqrt(-$a/$c),sqrt(-$a/$c)];
              };
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 56 -->
        <exercise label="ex-substitution-evaluate-general-4">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-4">
            <pg-code>
              $m = random(3,9,1);
              $c = non_zero_random(-9,9,1);
              $trig = list_random('tan','-cot');
              if($envir{problemSeed}==1){$m=3;$c=1;$trig='-cot'};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $dt = ($trig eq 'tan') ? '\sec^2' : '\csc^2';
              $h = Formula("x^$m+$c")->reduce;
              $g = Formula("$trig(x)")->D('x')->reduce->substitute(x=>$h)->reduce;
              $f = Formula("x^($m-1) $g")->reduce;
              $F = FormulaUpToConstant("$trig(x^$m+$c)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int x^{<var name="$m-1"/>} <var name="$dt"/>\left(<var name="$h"/>\right) \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 57 -->
        <exercise label="ex-substitution-evaluate-general-5">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-5">
            <pg-code>
              $trig = list_random('sin','-cos');
              if($envir{problemSeed}==1){$trig='-cos'};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $g = Formula("$trig(x)")->D('x')->reduce;
              $f = ($trig eq 'sin') ? Formula("cos(x) sqrt(sin(x))") : Formula("sin(x) sqrt(cos(x))");
              $F = FormulaUpToConstant("2/3*$trig(x)^(3/2)")->reduce;
              $F->{limits} = [0,pi/2];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>

        <exercise label="ex-substitution-evaluate-general-6">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-6">
            <pg-code>
              $m = random(2,9,1);
              $b = non_zero_random(-9,9,1);
              $trig = list_random('sin','cos');
              if($envir{problemSeed}==1){$trig='sin';$m=5;$b=1;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$trig($m x + $b)")->reduce;
              $F = Formula("-$trig(x)")->D('x')->reduce->substitute(x=>Formula("$m x + $b"));
              $F = FormulaUpToConstant("1/$m $F")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 59 -->
        <exercise label="ex-substitution-evaluate-general-7">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-7">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$b=-5};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              Context()->variables->set(x => {limits => [-$b-2,-$b+2]});
              $f = Formula("1/(x+$b)")->reduce;
              $F = FormulaUpToConstant("ln(abs(x+$b))")->reduce;
              $F->{test_at} = [[-$b-2],[-$b+2]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 60 -->
        <exercise label="ex-substitution-evaluate-general-8">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-8">
            <pg-code>
              ($a,$b,$c) = (1..9)[NchooseK(9,3)];
              if($envir{problemSeed}==1){$a=7;$b=3;$c=2;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              Context()->variables->set(x => {limits => [-$c/$b-2,-$c/$b+2]});
              $f = Formula("$a/($b x+$c)")->reduce;
              $frac = Fraction($a,$b);
              $F = FormulaUpToConstant("$frac ln(abs($b x+$c))")->reduce;
              $F->{test_at} = [[-$c/$b-2],[-$c/$b+2]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 61 -->
        <exercise label="ex-substitution-evaluate-general-9">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-9">
            <pg-code>
              do {($b,$c) = (-9..-1,1..9)[NchooseK(18,2)]} until (($b)**2 != 4*$c);
              $m = random(2,4,1);
              $k = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$b=3;$c=5;$m=3;$k=-5;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              if (($b)**2 > 4*$c) {
                ($min, $max) = num_sort((-$b - sqrt(($b)**2 - 4*$c))/2,(-$b + sqrt(($b)**2 - 4*$c))/2);
                $D = sqrt(($b)**2 - 4*$c);
                Context()->variables->set(x => {limits => [$min-$D,$max+$D]});
              };
              $denom = Formula("x^2 + $b x + $c")->reduce;
              $numer = Formula("$m x^3 + ($m*$b + $k)x^2 + ($m*$c + $b*$k + 2) x + ($c*$k + $b)")->reduce;
              $f = Formula("($numer)/($denom)");
              $frac = Fraction($m,2);
              $F = FormulaUpToConstant("$frac x^2 + $k x + ln(abs($denom))")->reduce;
              if (($b)**2 > 4*$c) {
                $F->{test_at} = [[$min-$D],[$max+$D]];
              };
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 62 -->
        <exercise label="ex-substitution-evaluate-general-10">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-10">
            <pg-code>
              do {($b,$c) = (-9..-1,1..9)[NchooseK(18,2)]} until (($b)**2 != 4*$c);
              if($envir{problemSeed}==1){$b=7;$c=3;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              if (($b)**2 > 4*$c) {
                ($min, $max) = num_sort((-$b - sqrt(($b)**2 - 4*$c))/2,(-$b + sqrt(($b)**2 - 4*$c))/2);
                $D = sqrt(($b)**2 - 4*$c);
                Context()->variables->set(x => {limits => [$min-$D,$max+$D]});
              };
              $denom = Formula("x^2 + $b x + $c")->reduce;
              $numer = Formula("2x + $b")->reduce;
              $f = Formula("($numer)/($denom)");
              $F = FormulaUpToConstant("ln(abs($denom))")->reduce;
              if (($b)**2 > 4*$c) {
                $F->{test_at} = [[$min-$D],[$max+$D]];
              };
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 63 -->
        <exercise label="ex-substitution-evaluate-general-11">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-11">
            <pg-code>
              do {($a,$b,$c) = (-9..-1,1..9)[NchooseK(18,3)]} until (($b)**2 != 4*$a*$c);
              $k = random(2,5,1);
              if($envir{problemSeed}==1){$a=3;$b=9;$c=7;$k=3;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              if (($b)**2 > 4*$a*$c) {
                ($min, $max) = num_sort((-$b - sqrt(($b)**2 - 4*$a*$c))/2,(-$b + sqrt(($b)**2 - 4*$a*$c))/2);
                $D = sqrt(($b)**2 - 4*$a*$c);
                Context()->variables->set(x => {limits => [$min-$D,$max+$D]});
              };
              $denom = Formula("$a x^2 + $b x + $c")->reduce;
              $g = gcd(2*$a,$b);
              $A = 2*$a/$g;
              $B = $b/$g;
              $numer = Formula("$g*$k ($A x + $B)")->reduce;
              $f = Formula("($numer)/($denom)");
              $F = FormulaUpToConstant("$k ln(abs($denom))")->reduce;
              if (($b)**2 > 4*$c) {
                $F->{test_at} = [[$min-$D],[$max+$D]];
              };
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 64 -->
        <exercise label="ex-substitution-evaluate-general-12">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-12">
            <pg-code>
              do {($b,$c) = (-9..-1,1..9)[NchooseK(18,2)]} until (($b)**2 != 4*$c);
              $k = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$b=-7;$c=1;$k=7;};
              $m = -1;
              Context("Fraction");
              Context()->noreduce('(-x)-y','(-x)+y');
              Context()->flags->set(reduceConstantFunctions=>0);
              if (($b)**2 > 4*$c) {
                ($min, $max) = num_sort((-$b - sqrt(($b)**2 - 4*$c))/2,(-$b + sqrt(($b)**2 - 4*$c))/2);
                $D = sqrt(($b)**2 - 4*$c);
                Context()->variables->set(x => {limits => [$min-$D,$max+$D]});
              };
              $denom = Formula("x^2 + $b x + $c")->reduce;
              $numer = Formula("$m x^3 + ($m*$b + $k)x^2 + ($m*$c + $b*$k + 2) x + ($c*$k + $b)")->reduce;
              $f = Formula("($numer)/($denom)");
              $frac = Fraction($m,2);
              $F = FormulaUpToConstant("$frac x^2 + $k x + ln(abs($denom))")->reduce;
              if (($b)**2 > 4*$c) {
                $F->{test_at} = [[$min-$D],[$max+$D]];
              };
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 65 -->
        <exercise label="ex-substitution-evaluate-general-13">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-13">
            <pg-code>
              $a = random(2,9,1);
              if($envir{problemSeed}==1){$a=9;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("x/(x^4+$a^2)")->reduce;
              $F = FormulaUpToConstant("1/(2*$a) atan(x^2/$a)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 66 -->
        <exercise label="ex-substitution-evaluate-general-14">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-14">
            <pg-code>
              $a = random(2,9,1);
              if($envir{problemSeed}==1){$a=2;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("$a/($a^2x^2+1)")->reduce;
              $F = FormulaUpToConstant("atan($a x)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 67 -->
        <exercise label="ex-substitution-evaluate-general-15">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-15">
            <pg-code>
              $a = random(2,9,1);
              if($envir{problemSeed}==1){$a=2;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              Context()->variables->set(x => {limits => [1/$a,1/$a+4]});
              $f = Formula("1/(x sqrt($a^2x^2-1))")->reduce;
              $F = FormulaUpToConstant("asec(abs($a x))")->reduce;
              $F->{test_at} = [[-1/$a-1],[-1/$a-2],[-1/$a-3],[-1/$a-4]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 68 -->
        <exercise label="ex-substitution-evaluate-general-16">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-16">
            <pg-code>
              ($a,$b) = (2..9)[NchooseK(8,2)];
              if($envir{problemSeed}==1){$a=4;$b=3;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              Context()->variables->set(x => {limits => [-$a/$b,$a/$b]});
              $f = Formula("1/sqrt($a^2 - $b^2 x^2)")->reduce;
              $F = FormulaUpToConstant("1/$b asin($b x/$a)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 69 -->
        <exercise label="ex-substitution-evaluate-general-17">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-17">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              $b = random(2,9,1);
              $c = non_zero_random(-9,9,1);
              $k = random(2,9,1);
              if($envir{problemSeed}==1){$a=-1;$b=3;$c=1;$k = 3;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $denom = Formula("x^2 + 2*$a x + (($a)^2 + $b^2)")->reduce;
              $numer = Formula("$k x + ($k*$a + $c)")->reduce;
              $f = Formula("($numer)/($denom)")->reduce;
              $frac = Fraction($k,2);
              $frac2 = Fraction($c,$b);
              $F = FormulaUpToConstant("$frac ln(abs($denom)) + $frac2 atan((x+$a)/$b)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 70 -->
        <exercise label="ex-substitution-evaluate-general-18">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-18">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              $b = random(2,9,1);
              $c = non_zero_random(1,19,1);
              $k = random(2,9,1);
              if($envir{problemSeed}==1){$a=6;$b=5;$c=19;$k=-2;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $denom = Formula("x^2 + 2*$a x + (($a)^2 + $b^2)")->reduce;
              $numer = Formula("$k x + ($k*$a + $c)")->reduce;
              $f = Formula("($numer)/($denom)")->reduce;
              $frac = Fraction($k,2);
              $frac2 = Fraction($c,$b);
              $F = FormulaUpToConstant("$frac2 atan((x+$a)/$b) + $frac ln(abs($denom))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 71 -->
        <exercise label="ex-substitution-evaluate-general-19">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-19">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              $b = list_random(2,3,5,6,7,10,11,13,14,15);
              $c = non_zero_random(1,50,1);
              $k = random(2,20,1);
              if($envir{problemSeed}==1){$a=-5;$b=7;$c=41;$k=15;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $denom = Formula("x^2 + 2*$a x + (($a)^2 + $b)")->reduce;
              $numer = Formula("x^2 + (2*$a+$k) x + (($a)^2 + $b + $k*$a + $c)")->reduce;
              $f = Formula("($numer)/($denom)")->reduce;
              $frac = Fraction($k,2);
              $F = FormulaUpToConstant("x+$c/sqrt($b) atan((x+$a)/sqrt($b)) + $frac ln(abs($denom))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 72 -->
        <exercise label="ex-substitution-evaluate-general-20">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-20">
            <pg-code>
              $b = random(2,9,1);
              if($envir{problemSeed}==1){$b=3;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("x^3/(x^2 + $b^2)")->reduce;
              $frac = Fraction($b**2,2);
              $F = FormulaUpToConstant("x^2/2 - $frac ln(abs(x^2+$b^2))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 73 -->
        <exercise label="ex-substitution-evaluate-general-21">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-21">
            <pg-code>
              $a = non_zero_random(-9,9,1);
              $b = list_random(2,3,5,6,7,10,11,13,14,15);
              $c = non_zero_random(1,50,1);
              $k = random(2,20,1);
              if($envir{problemSeed}==1){$a=2;$b=5;$c=24;$k=6;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $denom = Formula("x^2 + 2*$a x + (($a)^2 + $b)")->reduce;
              $numer = Formula("x^3 + ($b - 3*($a)^2 + $k)x + ((($a)^2+$b) (-2*$a) + $a*$k + $c)")->reduce;
              $f = Formula("($numer)/($denom)")->reduce;
              $frac = Fraction($k,2);
              $F = FormulaUpToConstant("1/2 x^2 - (2*$a) x + $frac ln(abs($denom)) + $c/sqrt($b) atan((x+$a)/sqrt($b))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 74 -->
        <exercise label="ex-substitution-evaluate-general-22">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-22">
            <pg-code>
              $F = FormulaUpToConstant("-atan(cos(x))");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \frac{\sin(x)}{\cos^2(x)+1} dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 75 -->
        <exercise label="ex-substitution-evaluate-general-23">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-23">
            <pg-code>
              $F = FormulaUpToConstant("atan(sin(x))");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \frac{\cos(x)}{\sin^2(x)+1} dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 76 -->
        <exercise label="ex-substitution-evaluate-general-24">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-24">
            <pg-code>
              $trig = list_random('sin','cos');
              if($envir{problemSeed}==1){$trig='sin'};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $num = ($trig eq 'cos') ? 'sin' : 'cos';
              $numtex = '\'.$num;
              $trigtex = '\'.$trig;
              $f = Formula("$num(x)/(1 - $trig^2(x))")->reduce;
              $F = FormulaUpToConstant("ln(abs(sec(x) + tan(x)))")->reduce;
              if ($trig eq 'cos') {
                $F = FormulaUpToConstant("-ln(abs(csc(x) + cot(x)))")->reduce;
              };
              $F->{test_at} = [[pi/4],[3*pi/4],[5*pi/4],[7*pi/4]];
            </pg-code>
            <statement>
              <p>
                <m>\ds \int \frac{<var name="$numtex"/>(x)}{1-<var name="$trigtex"/>^2(x)} \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 77 -->
        <exercise label="ex-substitution-evaluate-general-25">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-25">
            <pg-code>
              $h = non_zero_random(-9,9,1);
              $k = random(-9,-1,1);
              $c = random(3,9,1);
              if($envir{problemSeed}==1){$h=1;$k=-7;$c=3;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              Context()->variables->set(x => {limits => [$h-sqrt(-$k),$h+sqrt(-$k)]});
              $numer = Formula("$c x - $c*$h")->reduce;
              $quad = Formula("x^2 - (2*$h) x + (($h)^2+$k)")->reduce;
              $f = Formula("($numer)/(sqrt($quad))")->reduce;
              $F = FormulaUpToConstant("$c sqrt($quad)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 78 -->
        <exercise label="ex-substitution-evaluate-general-26">
          <webwork xml:id="webwork-ex-substitution-evaluate-general-26">
            <pg-code>
              $h = non_zero_random(-9,9,1);
              $k = random(-9,-1,1);
              if($envir{problemSeed}==1){$h=3;$k=-1;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              Context()->variables->set(x => {limits => [$h-sqrt(-$k),$h+sqrt(-$k)]});
              $numer = Formula("x - $h")->reduce;
              $quad = Formula("x^2 - (2*$h) x + (($h)^2+$k)")->reduce;
              $f = Formula("($numer)/(sqrt($quad))")->reduce;
              Context()->variables->set(x => {limits => [sqrt(-$k)+$h,sqrt(-$k)+$h+4]});
              $F = FormulaUpToConstant("sqrt($quad)")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$F" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>

      <exercisegroup cols="2" xml:id="exset-substitution-defint">
        <introduction>
          <p>
            Evaluate the definite integral.
          </p>
        </introduction>
        <!-- Exercise 79 -->
        <exercise label="ex-substitution-defint-1">
          <webwork xml:id="webwork-ex-substitution-defint-1">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              ($lb,$ub) = num_sort((-$b-9..-$b-1)[NchooseK(9,2)]);
              if($envir{problemSeed}==1){$b=-5;$lb=1;$ub=3};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("1/(x+$b)")->reduce;
              $frac = Fraction($ub+$b,$lb+$b);
              $A = Formula("ln($frac)");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 80 -->
        <exercise label="ex-substitution-defint-2">
          <webwork xml:id="webwork-ex-substitution-defint-2">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              ($lb,$ub) = num_sort((0,1,4,9,16,25,36,49,64,81)[NchooseK(10,2)]);
              $lb = $lb - $b;
              $ub = $ub - $b;
              if($envir{problemSeed}==1){$b=-2;$lb=2;$ub=6};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("x sqrt(x+$b)")->reduce;
              $fracu = Fraction(2*(($ub+$b)/5 - $b/3));
              $fracl = Fraction(2*(($lb+$b)/5 - $b/3));
              $A = Fraction($fracu*($ub + $b)**(3/2) - $fracl*($lb + $b)**(3/2));
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 81 -->
        <exercise label="ex-substitution-defint-3">
          <webwork xml:id="webwork-ex-substitution-defint-3">
            <pg-code>
              $trig = list_random('sin','cos');
              $lb = list_random('-pi','-pi/2');
              $ub = list_random('pi','pi/2');
              $n = random(2,5,1);
              if($envir{problemSeed}==1){$trig='sin';$lb='-pi/2';$ub='pi/2';$n=2;};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("sin^$n(x) cos(x)");
              $ftex = '\sin^' . $n . '(x)\cos(x)';
              $A = Fraction(1/($n+1)*sin(Real($ub))**($n+1) - 1/($n+1)*sin(Real($lb))**($n+1));
              if ($trig eq 'cos') {
                $f = Formula("cos^$n(x) sin(x)");
                $ftex = '\cos^' . $n . '(x)\sin(x)';
                $A = Fraction(-1/($n+1)*cos(Real($ub))**($n+1) + 1/($n+1)*cos(Real($lb))**($n+1));
              }
              $lb = Formula("$lb");
              $ub = Formula("$ub");
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$ftex"/> \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 82 -->
        <exercise label="ex-substitution-defint-4">
          <webwork xml:id="webwork-ex-substitution-defint-4">
            <pg-code>
              $n = random(3,9,1);
              if($envir{problemSeed}==1){$n=4;};
              $lb = 0;
              $ub = 1;
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("2x (1 - x^2)^$n");
              $A = Fraction(-1/($n+1)*(1 - $ub**2)**($n+1) + 1/($n+1)*(1 - $lb**2)**($n+1));
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 83 -->
        <exercise label="ex-substitution-defint-5">
          <webwork xml:id="webwork-ex-substitution-defint-5">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              ($lb,$ub) = num_sort((-$b-2..-$b+2)[NchooseK(5,2)]);
              if($envir{problemSeed}==1){$b=1;$lb=-2;$ub=-1};
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("(x+$b) e^(x^2 + 2*$b x + ($b)^2)")->reduce;
              $A = Formula("1/2 (e^(($ub + $b)^2) - e^(($lb + $b)^2))")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 84 -->
        <exercise label="ex-substitution-defint-6">
          <webwork xml:id="webwork-ex-substitution-defint-6">
            <pg-code>
              $A = Formula("pi/2")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{-1}^{1} \frac{1}{1+x^2} \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 85 -->
        <exercise label="ex-substitution-defint-7">
          <webwork xml:id="webwork-ex-substitution-defint-7">
            <pg-code>
              $b = non_zero_random(-9,9,1);
              if($envir{problemSeed}==1){$b=-3;};
              $lb = -$b-1;
              $ub = -$b+1;
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("1/(x^2 + 2*$b x + (($b)^2+1))")->reduce;
              $A = Formula("pi/2")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
        <!-- Exercise 86 -->
        <exercise label="ex-substitution-defint-8">
          <webwork xml:id="webwork-ex-substitution-defint-8">
            <pg-code>
              ($lbindex,$ubindex) = num_sort((0..8)[NchooseK(9,2)]);
              if($envir{problemSeed}==1){$lbindex=5;$ubindex=7;};
              ($lb,$ub) = (-2,'-sqrt(3)','-sqrt(2)',-1,0,1,'sqrt(2)','sqrt(3)',2)[$lbindex,$ubindex];
              Context()->flags->set(reduceConstantFunctions=>0);
              $lb = Formula("$lb");
              $ub = Formula("$ub");
              Context("Fraction");
              Context()->flags->set(reduceConstantFunctions=>0);
              $f = Formula("1/sqrt(4 - x^2)")->reduce;
              $A = Real("arcsin($ub/2) - arcsin($lb/2)");
              $frac = Fraction($A/pi);
              $A = Formula("$frac pi")->reduce;
            </pg-code>
            <statement>
              <p>
                <m>\ds \int_{<var name="$lb"/>}^{<var name="$ub"/>} <var name="$f"/> \, dx</m>
              </p>
              <p>
                <var name="$A" width="40"/>
              </p>
            </statement>
          </webwork>
        </exercise>
      </exercisegroup>
    </subexercises>
  </exercises>
</section>
